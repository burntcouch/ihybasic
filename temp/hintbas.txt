ca65 V2.19 - Git ffa83c3
Main file   : intbasic.s
Current file: intbasic.s

000000r 1               ;*****************************************************************
000000r 1               ;* Integer BASIC for the Apple II                                               *
000000r 1               ;* By Steve Wozniak                                                             *
000000r 1               ;* Copyright 1977 by Apple Computer, Inc.                                       *
000000r 1               ;
000000r 1               ; **** converted to ca65 format and port to Hyrda-16                            *
000000r 1               ; **** 2026 by Patrick Struthers                                                *
000000r 1               ; ****
000000r 1               ;********************************************************************************
000000r 1               .setcpu "65C02"
000000r 1               .debuginfo
000000r 1               
000000r 1               .macro WRITECRLF
000000r 1                   lda   #$0D
000000r 1                   jsr   WRITE_CHAR
000000r 1                   lda   #$0A
000000r 1                   jsr   WRITE_CHAR
000000r 1               .endmacro
000000r 1               
000000r 1               ;
000000r 1               ; ****** CONSTANTS
000000r 1               ;
000000r 1               ETX             =     $03              ;Ctrl+C
000000r 1               CR              =     $0d              ;carriage return
000000r 1               BLANK           =     $20              ;space
000000r 1               DQT             =     $22              ;double quote
000000r 1               ;
000000r 1               ; ****** ZEROPAGE LOCS
000000r 1               ;
000000r 1               MON_WNDWDTH     =     $21               ;width of scroll window
000000r 1               MON_CH          =     $24               ;cursor horizontal displacement
000000r 1               MON_CV          =     $25               ;cursor vertical displacement
000000r 1               MON_GBASL       =     $26               ;base address for lo-res drawing (lo)
000000r 1               MON_H2          =     $2c               ;right end of horizontal line drawn by HLINE
000000r 1               MON_V2          =     $2d               ;bottom of vertical line drawn by VLINE
000000r 1               MON_PROMPT      =     $33               ;prompt character
000000r 1               MON_A1L         =     $3c               ;general purpose
000000r 1               MON_A1H         =     $3d               ;general purpose
000000r 1               MON_A2L         =     $3e               ;general purpose
000000r 1               MON_A2H         =     $3f               ;general purpose
000000r 1               LOMEM           =     $4a             ;pointer to start of variables
000000r 1               HIMEM           =     $4c             ;pointer to end of program
000000r 1               MON_RNDL        =     $4e               ;low byte of KEYIN "random" value
000000r 1               MON_RNDH        =     $4f               ;high byte of KEYIN "random" value
000000r 1               NOUNSTKL        =     $50             ;noun stack low bytes
000000r 1               SYNSTKH         =     $58               ;syntax stack high byte
000000r 1               NOUNSTKH        =     $78            ;noun stack high bytes
000000r 1               SYNSTKL         =     $80            ;syntax stack low bytes
000000r 1               NOUNSTKC        =     $a0            ;noun stack counter
000000r 1               TXTNDXSTK       =     $a8            ;text index stack
000000r 1               TXTNDX          =     $c8               ;text index val (OUTVAL)
000000r 1               LEADBL          =     $c9               ;leading blanks index (YTEMP)
000000r 1               PP              =     $ca             ;pointer to start of program
000000r 1               PV              =     $cc             ;pointer to end of vars
000000r 1               ACC             =     $ce             ;main accumulator
000000r 1               SRCH            =     $d0             ;pointer to search var table
000000r 1               TOKNDXSTK       =     $d1            ;token index stack
000000r 1               SRCH2           =     $d2             ;second var search pointer
000000r 1               IFFLAG          =     $d4               ;IF/THEN fail flag
000000r 1               CRFLAG          =     $d5               ;carriage return flag
000000r 1               VERBNOW         =     $d6               ;verb currently in use
000000r 1               PRFLAG          =     $d7               ;print it now flag
000000r 1               XSAVE           =     $d8               ;temp X-reg save
000000r 1               RUNFLAG         =     $d9               ;run mode flag
000000r 1               AUX             =     $da             ;aux counter
000000r 1               PR              =     $dc             ;current line value
000000r 1               PX              =     $e0             ;pointer to current verb
000000r 1               P1              =     $e2             ;aux pointer 1 (delete line ptr)
000000r 1               P2              =     $e4             ;aux pointer 2 (line num , next num, ...)
000000r 1               P3              =     $e6             ;aux pointer 3 (next ptr)
000000r 1               TOKNDX          =     $f1               ;token index val
000000r 1               PCON            =     $f2             ;continue pointer (PRDEC low/hi)
000000r 1               AUTOINC         =     $f4             ;auto line increment
000000r 1               AUTOLN          =     $f6             ;current auto line
000000r 1               AUTOFLAG        =     $f8               ;auto line mode flag ($ff=on)
000000r 1               CHAR            =     $f9               ;current char
000000r 1               LEADZR          =     $fa               ;leading zeroes index ($00,$a0,$b0)
000000r 1               FORNDX          =     $fb               ;FOR-NEXT loop index
000000r 1               GOSUBNDX        =     $fc               ;GOSUB index
000000r 1               SYNSTKDX        =     $fd               ;syntax stack index val
000000r 1               SYNPAG          =     $fe             ;pointer to syntax page
000000r 1               ;
000000r 1               ; other locations
000000r 1               ;
000000r 1               STK_00          =     $0100
000000r 1               STK_10          =     $0110
000000r 1               STK_20          =     $0120
000000r 1               STK_30          =     $0130
000000r 1               STK_40          =     $0140
000000r 1               STK_50          =     $0150
000000r 1               STK_60          =     $0160
000000r 1               STK_70          =     $0170
000000r 1               STK_80          =     $0180
000000r 1               STK_90          =     $0190
000000r 1               STK_A0          =     $01a0
000000r 1               STK_B0          =     $01b0
000000r 1               STK_C0          =     $01c0
000000r 1               STK_D0          =     $01d0
000000r 1               IN              =     $0200             ;input buffer
000000r 1               ;
000000r 1               ;  jumpy places in Apple ROM, find Hydra-16 equivalents
000000r 1               ;
000000r 1               ;KBD            = $c000             ;R last key pressed + 128  ---  see BIOS section at end of this file
000000r 1               KBDSTRB         = $c010             ;RW keyboard strobe  --- PGS:  lookup
000000r 1               
000000r 1               MON_NXTCHAR     = $fd75             ; PGS:  lookup this monitor routine
000000r 1               ;MON_COUT       = $F8B6             ;print Acc to output device via $36-37 ---  see BIOS section at end of this file
000000r 1               ;MONRDKEY       = $F843
000000r 1               WRITE_CHAR      = $F8B6             ; will point to WRITE_CHAR in hydra bios
000000r 1               READ_CHAR       = $F843             ;  READ_CHAR
000000r 1               
000000r 1               .segment "INPUT_BUFFER"
000000r 1  xx xx xx xx                   .res 256
000004r 1  xx xx xx xx  
000008r 1  xx xx xx xx  
000100r 1               .segment "CODE"
000000r 1               ;
000000r 1               
000000r 1  20 rr rr     BASIC:           jsr     COLD
000003r 1  4C rr rr     BASIC2:          jmp     WARM
000006r 1               
000006r 1  85 33        SetPrompt:       sta     MON_PROMPT
000008r 1  4C rr rr                      jmp     MON_COUT
00000Br 1               
00000Br 1  60                           .byte    $60
00000Cr 1               
00000Cr 1  8A           LE00C:           txa                       ;print a trailing blank?
00000Dr 1  29 20                         and     #$20
00000Fr 1  F0 23                         beq     Rtn0
000011r 1  A9 A0        LE011:           lda     #BLANK+128
000013r 1  85 E4                         sta     P2
000015r 1  4C rr rr                      jmp     MON_COUT
000018r 1               
000018r 1  A9 20        LE018:           lda     #32
00001Ar 1  C5 24        LE01A:           cmp     MON_CH            ;check line length
00001Cr 1  B0 0C                         bcs     NextByte          ;line too short
00001Er 1  A9 8D                         lda     #CR+128           ;print CR, then 7 blanks
000020r 1  A0 07                         ldy     #$07
000022r 1  20 rr rr     Loop0:           jsr     MON_COUT
000025r 1  A9 A0                         lda     #BLANK+128
000027r 1  88                            dey
000028r 1  D0 F8                         bne     Loop0
00002Ar 1               ;
00002Ar 1  A0 00        NextByte:        ldy     #$00              ;get next byte 16-bit ptr
00002Cr 1  B1 E2                         lda     (P1),y
00002Er 1  E6 E2                         inc     P1
000030r 1  D0 02                         bne     Rtn0
000032r 1  E6 E3                         inc     P1+1
000034r 1  60           Rtn0:            rts
000035r 1               
000035r 1               ;
000035r 1               ; Token $75 , (with token $74 LIST)
000035r 1               ;  LIST 5,30
000035r 1               ;
000035r 1  20 rr rr     COMMA_LIST:      jsr     GET16BIT
000038r 1  20 rr rr                      jsr     LE576
00003Br 1  A5 E2        LE03B:           lda     P1
00003Dr 1  C5 E6                         cmp     P3
00003Fr 1  A5 E3                         lda     P1+1
000041r 1  E5 E7                         sbc     P3+1
000043r 1  B0 EF                         bcs     Rtn0
000045r 1  20 rr rr                      jsr     UNPACK
000048r 1  4C rr rr                      jmp     LE03B
00004Br 1               
00004Br 1               ;
00004Br 1               ; Token $76 LIST
00004Br 1               ;  list entire program
00004Br 1               ;
00004Br 1  A5 CA        LIST:           lda     PP                ;P1 = PP
00004Dr 1  85 E2                        sta     P1
00004Fr 1  A5 CB                        lda     PP+1
000051r 1  85 E3                        sta     P1+1
000053r 1  A5 4C                        lda     HIMEM             ;P3 = HIMEM
000055r 1  85 E6                        sta     P3
000057r 1  A5 4D                        lda     HIMEM+1
000059r 1  85 E7                        sta     P3+1
00005Br 1  D0 DE                        bne     LE03B             ;(always)
00005Dr 1               ;
00005Dr 1               ; Token $74 LIST
00005Dr 1               ;  specific line number or range of numbers
00005Dr 1               ;  LIST 10: LIST 5,30
00005Dr 1               ;
00005Dr 1  20 rr rr     LISTNUM:        jsr     GET16BIT
000060r 1  20 rr rr                     jsr     LE56D
000063r 1  A5 E4                        lda     P2                ;P1 = P2
000065r 1  85 E2                        sta     P1
000067r 1  A5 E5                        lda     P2+1
000069r 1  85 E3                        sta     P1+1
00006Br 1  B0 C7                        bcs     Rtn0
00006Dr 1               ; Unpack tokens to mnemonics.
00006Dr 1  86 D8        UNPACK:         stx     XSAVE
00006Fr 1  A9 A0                        lda     #BLANK+128
000071r 1  85 FA                        sta     LEADZR
000073r 1  20 rr rr                     jsr     NextByte
000076r 1  98                           tya
000077r 1  85 E4        LE077:          sta     P2
000079r 1  20 rr rr                     jsr     NextByte
00007Cr 1  AA                           tax
00007Dr 1  20 rr rr                     jsr     NextByte
000080r 1  20 rr rr                     jsr     PRDEC
000083r 1  20 rr rr     BigLoop:        jsr     LE018
000086r 1  84 FA                        sty     LEADZR
000088r 1  AA                           tax
000089r 1  10 18                        bpl     LE0A3
00008Br 1  0A                           asl     A
00008Cr 1  10 E9                        bpl     LE077
00008Er 1  A5 E4                        lda     P2
000090r 1  D0 03                        bne     NotEq0
000092r 1  20 rr rr                     jsr     LE011
000095r 1  8A           NotEq0:         txa
000096r 1  20 rr rr     Loop2:          jsr     MON_COUT
000099r 1  A9 25        LE099:          lda     #$25
00009Br 1  20 rr rr                     jsr     LE01A
00009Er 1  AA                           tax
00009Fr 1  30 F5                        bmi     Loop2
0000A1r 1  85 E4                        sta     P2
0000A3r 1  C9 01        LE0A3:           cmp     #$01
0000A5r 1  D0 05                        bne     NotEq1
0000A7r 1  A6 D8                        ldx     XSAVE
0000A9r 1  4C rr rr                     jmp     MON_CROUT
0000ACr 1               
0000ACr 1  48           NotEq1:         pha
0000ADr 1  84 CE                        sty     ACC
0000AFr 1  A2 rr                        ldx     #>SYNTABL2
0000B1r 1  86 CF                        stx     ACC+1
0000B3r 1  C9 51                        cmp     #$51              ;END token
0000B5r 1  90 04                        bcc     Loop5
0000B7r 1  C6 CF                        dec     ACC+1             ;in SYNTABL
0000B9r 1  E9 50                        sbc     #$50              ;TAB tkn
0000BBr 1  48           Loop5:          pha
0000BCr 1  B1 CE                        lda     (ACC),y
0000BEr 1  AA           Loop3:          tax
0000BFr 1  88                           dey
0000C0r 1  B1 CE                        lda     (ACC),y
0000C2r 1  10 FA                        bpl     Loop3
0000C4r 1  E0 C0                        cpx     #$c0
0000C6r 1  B0 04                        bcs     LE0CC
0000C8r 1  E0 00                        cpx     #$00
0000CAr 1  30 F2                        bmi     Loop3
0000CCr 1  AA           LE0CC:          tax
0000CDr 1  68                           pla
0000CEr 1  E9 01                        sbc     #$01              ;carry is set
0000D0r 1  D0 C4                        bne     Loop2
0000D2r 1  24 E4                        bit     P2
0000D4r 1  30 03                        bmi     Loop4
0000D6r 1  20 rr rr                     jsr     LEFF8
0000D9r 1  B1 CE        Loop4:          lda     (ACC),y
0000DBr 1  10 10                        bpl     LE0ED
0000DDr 1  AA                           tax
0000DEr 1  29 3F                        and     #$3f
0000E0r 1  85 E4                        sta     P2
0000E2r 1  18                           clc
0000E3r 1  69 A0                        adc     #BLANK+128
0000E5r 1  20 rr rr                     jsr     MON_COUT
0000E8r 1  88                           dey
0000E9r 1  E0 C0                        cpx     #$c0
0000EBr 1  90 EC                        bcc     Loop4
0000EDr 1  20 rr rr     LE0ED:          jsr     LE00C
0000F0r 1  68                           pla
0000F1r 1  C9 5D                        cmp     #']'
0000F3r 1  F0 A4                        beq     LE099
0000F5r 1  C9 28                        cmp     #'('
0000F7r 1  D0 8A                        bne     BigLoop      ; not sure about this
0000F9r 1  F0 9E                        beq     LE099             ;(always)
0000FBr 1               
0000FBr 1               ;
0000FBr 1               ; Token $2a (
0000FBr 1               ;   substring
0000FBr 1               ;   PRINT A$(12,14)
0000FBr 1               ;
0000FBr 1  20 rr rr     PAREN_SUBSTR:   jsr     LE118
0000FEr 1  95 50                        sta     NOUNSTKL,x
000100r 1  D5 78                        cmp     NOUNSTKH,x
000102r 1  90 11        LE102:          bcc     LE115
000104r 1  A0 rr        PrintErr05:     ldy     #<ErrMsg05        ;"STRING"
000106r 1  4C rr rr     LE106:          jmp     ERRMESS
000109r 1               
000109r 1               ;
000109r 1               ; Token $23 ,
000109r 1               ;   substring
000109r 1               ;   PRINT A$(3,3)
000109r 1               ;
000109r 1  20 rr rr     COMMA_SUBSTR:   jsr     GETBYTE
00010Cr 1  D5 50                        cmp     NOUNSTKL,x
00010Er 1  90 F4                        bcc     PrintErr05        ;"STRING"
000110r 1  20 rr rr                     jsr     LEFE4
000113r 1  95 78                        sta     NOUNSTKH,x
000115r 1  4C rr rr     LE115:          jmp     TE823
000118r 1               
000118r 1  20 rr rr     LE118:          jsr     GETBYTE
00011Br 1  F0 E7                        beq     PrintErr05        ;"STRING"
00011Dr 1  38                           sec
00011Er 1  E9 01                        sbc     #$01
000120r 1  60                           rts
000121r 1               
000121r 1               ;
000121r 1               ; Token $42 (
000121r 1               ;   string array is destination of the data
000121r 1               ;   A$(1)="HELLO"
000121r 1               ;
000121r 1  20 rr rr     TE121:          jsr     LE118
000124r 1  95 50                        sta     NOUNSTKL,x
000126r 1  18                           clc
000127r 1  F5 78                        sbc     NOUNSTKH,x
000129r 1  4C rr rr                     jmp     LE102
00012Cr 1               
00012Cr 1  A0 rr        PrintErr03:     ldy     #<ErrMsg03        ;"MEM FULL"
00012Er 1  D0 D6                        bne     LE106             ;(always)
000130r 1               
000130r 1               ;
000130r 1               ; Token $43 ,
000130r 1               ;   next var in DIM statement is string
000130r 1               ;   DIM X(5),A$(5)
000130r 1               ;
000130r 1               ; token $4e DIM
000130r 1               ;   string var uses token $22 (
000130r 1               ;   DIM A$(5)
000130r 1               ;
000130r 1  20 rr rr     DIMSTR:          jsr     LE118
000133r 1  E8                           inx
000134r 1  B5 50        LE134:           lda     NOUNSTKL,x
000136r 1  85 DA                        sta     AUX
000138r 1  65 CE                        adc     ACC
00013Ar 1  48                           pha
00013Br 1  A8                           tay
00013Cr 1  B5 78                        lda     NOUNSTKH,x
00013Er 1  85 DB                        sta     AUX+1
000140r 1  65 CF                        adc     ACC+1
000142r 1  48                           pha
000143r 1  C4 CA                        cpy     PP
000145r 1  E5 CB                        sbc     PP+1
000147r 1  B0 E3                        bcs     PrintErr03        ;"MEM FULL"
000149r 1  A5 DA                        lda     AUX               ;AUX = AUX - 2
00014Br 1  69 FE                        adc     #$fe
00014Dr 1  85 DA                        sta     AUX
00014Fr 1  A9 FF                        lda     #$ff
000151r 1  A8                           tay
000152r 1  65 DB                        adc     AUX+1
000154r 1  85 DB                        sta     AUX+1
000156r 1  C8           Loop10:         iny
000157r 1  B1 DA                        lda     (AUX),y
000159r 1  D9 CC 00                     cmp     PV,y
00015Cr 1  D0 0F                        bne     DimErr
00015Er 1  98                           tya
00015Fr 1  F0 F5                        beq     Loop10
000161r 1  68           Loop11:         pla
000162r 1  91 DA                        sta     (AUX),y
000164r 1  99 CC 00                     sta     PV,y
000167r 1  88                           dey
000168r 1  10 F7                        bpl     Loop11
00016Ar 1  E8                           inx
00016Br 1  60                           rts
00016Cr 1               
00016Cr 1  EA                           .byte    $ea
00016Dr 1               
00016Dr 1  A0 rr        DimErr:          ldy     #<ErrMsg17        ;"DIM"
00016Fr 1  D0 95        LE16F:           bne     LE106             ;(always)
000171r 1               
000171r 1               ;
000171r 1               ; Input a string.
000171r 1               ;
000171r 1  A9 00        INPUTSTR:        lda     #$00
000173r 1  20 rr rr                     jsr     LE70A
000176r 1  A0 02                        ldy     #$02
000178r 1  94 78                        sty     NOUNSTKH,x
00017Ar 1  20 rr rr                     jsr     LE70A
00017Dr 1  86 D8                        stx     XSAVE
00017Fr 1  AA                           tax
000180r 1  E6 33                        inc     MON_PROMPT        ;change '>' to '?'
000182r 1  20 rr rr                     jsr     RDKEY
000185r 1  C6 33                        dec     MON_PROMPT        ;change '?' to '>'
000187r 1  8A                           txa
000188r 1  A6 D8                        ldx     XSAVE
00018Ar 1  95 78                        sta     NOUNSTKH,x
00018Cr 1               ;
00018Cr 1               ; Token $70 =
00018Cr 1               ;   string - non-conditional
00018Cr 1               ;   A$ = "HELLO"
00018Cr 1               ;
00018Cr 1  B5 51        TE18C:           lda     NOUNSTKL+1,x
00018Er 1  85 CE                        sta     ACC
000190r 1  B5 79                        lda     NOUNSTKH+1,x
000192r 1  85 CF                        sta     ACC+1
000194r 1  E8                           inx
000195r 1  E8                           inx
000196r 1  20 rr rr                     jsr     LE1BC
000199r 1  B5 4E        Loop12:           lda     NOUNSTKL-2,x
00019Br 1  D5 76                        cmp     NOUNSTKH-2,x
00019Dr 1  B0 15                        bcs     LE1B4
00019Fr 1  F6 4E                        inc     NOUNSTKL-2,x
0001A1r 1  A8                           tay
0001A2r 1  B1 CE                        lda     (ACC),y
0001A4r 1  B4 50                        ldy     NOUNSTKL,x
0001A6r 1  C4 E4                        cpy     P2
0001A8r 1  90 04                        bcc     LE1AE
0001AAr 1  A0 rr                        ldy     #<ErrMsg18        ;"STR OVFL"
0001ACr 1  D0 C1                        bne     LE16F             ;(always)
0001AEr 1               
0001AEr 1  91 DA        LE1AE:           sta     (AUX),y
0001B0r 1  F6 50                        inc     NOUNSTKL,x
0001B2r 1  90 E5                        bcc     Loop12
0001B4r 1               
0001B4r 1  B4 50        LE1B4:           ldy     NOUNSTKL,x
0001B6r 1  8A                           txa
0001B7r 1  91 DA                        sta     (AUX),y
0001B9r 1  4C rr rr                     jmp     LF223
0001BCr 1               
0001BCr 1  B5 51        LE1BC:           lda     NOUNSTKL+1,x
0001BEr 1  85 DA                        sta     AUX
0001C0r 1  38                           sec
0001C1r 1  E9 02                        sbc     #$02
0001C3r 1  85 E4                        sta     P2
0001C5r 1  B5 79                        lda     NOUNSTKH+1,x
0001C7r 1  85 DB                        sta     AUX+1
0001C9r 1  E9 00                        sbc     #$00
0001CBr 1  85 E5                        sta     P2+1
0001CDr 1  A0 00                        ldy     #$00
0001CFr 1  B1 E4                        lda     (P2),y
0001D1r 1  18                           clc
0001D2r 1  E5 DA                        sbc     AUX
0001D4r 1  85 E4                        sta     P2
0001D6r 1  60                           rts
0001D7r 1               
0001D7r 1               ;
0001D7r 1               ; Token $39 =
0001D7r 1               ;   string logic op
0001D7r 1               ;   IF A$ = "CAT" THEN END
0001D7r 1               ;
0001D7r 1  B5 53        TE1D7:           lda     NOUNSTKL+3,x
0001D9r 1  85 CE                        sta     ACC
0001DBr 1  B5 7B                        lda     NOUNSTKH+3,x
0001DDr 1  85 CF                        sta     ACC+1
0001DFr 1  B5 51                        lda     NOUNSTKL+1,x
0001E1r 1  85 DA                        sta     AUX
0001E3r 1  B5 79                        lda     NOUNSTKH+1,x
0001E5r 1  85 DB                        sta     AUX+1
0001E7r 1  E8                           inx
0001E8r 1  E8                           inx
0001E9r 1  E8                           inx
0001EAr 1  A0 00                        ldy     #$00
0001ECr 1  94 78                        sty     NOUNSTKH,x
0001EEr 1  94 A0                        sty     NOUNSTKC,x
0001F0r 1  C8                           iny
0001F1r 1  94 50                        sty     NOUNSTKL,x
0001F3r 1  B5 4D        LE1F3:          lda     HIMEM+1,x
0001F5r 1  D5 75                        cmp     NOUNSTKH-3,x
0001F7r 1  08                           php
0001F8r 1  48                           pha
0001F9r 1  B5 4F                        lda     NOUNSTKL-1,x
0001FBr 1  D5 77                        cmp     NOUNSTKH-1,x
0001FDr 1  90 07                        bcc     LE206
0001FFr 1  68                           pla
000200r 1  28                           plp
000201r 1  B0 02                        bcs     Rtn4
000203r 1  56 50        LoopExit13:     lsr     NOUNSTKL,x
000205r 1  60           Rtn4:           rts
000206r 1               
000206r 1  A8           LE206:          tay
000207r 1  B1 CE                        lda     (ACC),y
000209r 1  85 E4                        sta     P2
00020Br 1  68                           pla
00020Cr 1  A8                           tay
00020Dr 1  28                           plp
00020Er 1  B0 F3                        bcs     LoopExit13
000210r 1  B1 DA                        lda     (AUX),y
000212r 1  C5 E4                        cmp     P2
000214r 1  D0 ED                        bne     LoopExit13
000216r 1  F6 4F                        inc     NOUNSTKL-1,x
000218r 1  F6 4D                        inc     HIMEM+1,x
00021Ar 1  B0 D7                        bcs     LE1F3             ;(always)
00021Cr 1               ;
00021Cr 1               ; Token $3a #
00021Cr 1               ;   string logic op
00021Cr 1               ;   IF A$ # "CAT" THEN END
00021Cr 1               ;
00021Cr 1  20 rr rr     TE21C:           jsr     TE1D7
00021Fr 1  4C rr rr                     jmp     NOT
000222r 1               
000222r 1               ;
000222r 1               ; Token $14 *
000222r 1               ;   num math op
000222r 1               ;   A = 27 * 2
000222r 1               ;
000222r 1  20 rr rr     MULT:            jsr     LE254
000225r 1  06 CE        Loop15:          asl     ACC
000227r 1  26 CF                        rol     ACC+1             ;add partial product if C flag set
000229r 1  90 0D                        bcc     LE238
00022Br 1  18                           clc
00022Cr 1  A5 E6                        lda     P3
00022Er 1  65 DA                        adc     AUX
000230r 1  85 E6                        sta     P3
000232r 1  A5 E7                        lda     P3+1
000234r 1  65 DB                        adc     AUX+1
000236r 1  85 E7                        sta     P3+1
000238r 1  88           LE238:           dey
000239r 1  F0 09                        beq     MultEnd           ;exit loop
00023Br 1  06 E6                        asl     P3
00023Dr 1  26 E7                        rol     P3+1
00023Fr 1  10 E4                        bpl     Loop15
000241r 1  4C rr rr                     jmp     Err32767
000244r 1               
000244r 1  A5 E6        MultEnd:         lda     P3
000246r 1  20 rr rr                     jsr     LE708
000249r 1  A5 E7                        lda     P3+1
00024Br 1  95 A0                        sta     NOUNSTKC,x
00024Dr 1  06 E5                        asl     P2+1
00024Fr 1  90 28                        bcc     Rtn6
000251r 1  4C rr rr                     jmp     NEGATE
000254r 1               
000254r 1  A9 55        LE254:          lda     #$55
000256r 1  85 E5                        sta     P2+1
000258r 1  20 rr rr                     jsr     LE25B
00025Br 1  A5 CE        LE25B:          lda     ACC               ;AUX = ACC
00025Dr 1  85 DA                        sta     AUX
00025Fr 1  A5 CF                        lda     ACC+1
000261r 1  85 DB                        sta     AUX+1
000263r 1  20 rr rr                     jsr     GET16BIT
000266r 1  84 E6                        sty     P3
000268r 1  84 E7                        sty     P3+1
00026Ar 1  A5 CF                        lda     ACC+1
00026Cr 1  10 09                        bpl     LE277
00026Er 1  CA                           dex
00026Fr 1  06 E5                        asl     P2+1
000271r 1  20 rr rr                     jsr     NEGATE
000274r 1  20 rr rr                     jsr     GET16BIT
000277r 1  A0 10        LE277:          ldy     #$10
000279r 1  60           Rtn6:           rts
00027Ar 1               
00027Ar 1               ;
00027Ar 1               ; Token $1f MOD
00027Ar 1               ;   num op
00027Ar 1               ;   IF X MOD 13 THEN END
00027Ar 1               ;
00027Ar 1  20 rr rr     MOD:             jsr     LEE6C
00027Dr 1  F0 C5                        beq     MultEnd           ;(always)
00027Fr 1  FF                           .byte    $ff
000280r 1               
000280r 1  E6 33        LE280:           inc     MON_PROMPT        ;change '>' to '?'
000282r 1  A0 00                        ldy     #$00
000284r 1  20 rr rr                     jsr     GETCMD
000287r 1  C6 33                        dec     MON_PROMPT        ;change '?' to '>'
000289r 1  60                           rts
00028Ar 1               
00028Ar 1               ;
00028Ar 1               ; Token $3d SCRN(
00028Ar 1               ;   PRINT SCRN(X,Y)
00028Ar 1               ;
00028Ar 1  20 rr rr     SCRN:            jsr     GETBYTE
00028Dr 1  4A                           lsr     A                 ;A-reg = A-reg / 2
00028Er 1  08                           php                       ;stash carry (lsb)
00028Fr 1  20 rr rr                     jsr     MON_GBASCALC
000292r 1  20 rr rr                     jsr     GETBYTE
000295r 1  A8                           tay
000296r 1  B1 26                        lda     (MON_GBASL),y     ;get screen byte
000298r 1  28                           plp                       ;retrieve carry
000299r 1  90 04                        bcc     LE29F
00029Br 1  4A                           lsr     A                 ;odd; upper half
00029Cr 1  4A                           lsr     A
00029Dr 1  4A                           lsr     A
00029Er 1  4A                           lsr     A
00029Fr 1  29 0F        LE29F:           and     #$0f              ;A-reg = color number
0002A1r 1  A0 00                        ldy     #$00
0002A3r 1  20 rr rr                     jsr     LE708
0002A6r 1  94 A0                        sty     NOUNSTKC,x
0002A8r 1  88                           dey
0002A9r 1  84 D7                        sty     PRFLAG            ;PRFLAG = $ff
0002ABr 1               ;
0002ABr 1               ; Token $3e ,
0002ABr 1               ;   PRINT SCRN(X,Y)
0002ABr 1               ;
0002ABr 1  60           COMMA_SCRN:      rts
0002ACr 1               
0002ACr 1  FF FF FF FF                  .byte   $ff,$ff,$ff,$ff
0002B0r 1               
0002B0r 1  20 rr rr     unref_e2b0:      jsr     LEFD3             ;old 4K cold start
0002B3r 1               ;
0002B3r 1               ; Warm start.  Main compile / execute code.
0002B3r 1               ;
0002B3r 1  20 rr rr     WARM:            jsr     MON_CROUT         ;emit blank line
0002B6r 1  46 D9        LE2B6:           lsr     RUNFLAG           ;not running
0002B8r 1  A9 3E                        lda     #'>'
0002BAr 1  20 rr rr                     jsr     SetPrompt         ;set and print prompt char
0002BDr 1  A0 00                        ldy     #$00
0002BFr 1  84 FA                        sty     LEADZR            ;no leading zeroes for AUTOLN
0002C1r 1  24 F8                        bit     AUTOFLAG          ;AUTO?
0002C3r 1  10 0C                        bpl     LE2D1
0002C5r 1  A6 F6                        ldx     AUTOLN            ;yes, print line number
0002C7r 1  A5 F7                        lda     AUTOLN+1
0002C9r 1  20 rr rr                     jsr     PRDEC
0002CCr 1  A9 A0                        lda     #BLANK+128
0002CEr 1  20 rr rr                     jsr     MON_COUT
0002D1r 1  A2 FF        LE2D1:           ldx     #$ff              ;init S-reg
0002D3r 1  9A                           txs
0002D4r 1  20 rr rr                     jsr     GETCMD
0002D7r 1  84 F1                        sty     TOKNDX
0002D9r 1  8A                           txa
0002DAr 1  85 C8                        sta     TXTNDX
0002DCr 1  A2 20                        ldx     #$20
0002DEr 1  20 rr rr                     jsr     LE491
0002E1r 1  A5 C8                        lda     TXTNDX            ;PX = TXTNDX + $0200 + C-flag
0002E3r 1  69 00                        adc     #$00
0002E5r 1  85 E0                        sta     PX
0002E7r 1  A9 00                        lda     #$00
0002E9r 1  AA                           tax
0002EAr 1  69 02                        adc     #$02
0002ECr 1  85 E1                        sta     PX+1
0002EEr 1  A1 E0                        lda     (PX,x)
0002F0r 1  29 F0                        and     #$f0
0002F2r 1  C9 30                        cmp     #'0'
0002F4r 1  F0 03                        beq     LE2F9
0002F6r 1  4C rr rr                     jmp     LE883
0002F9r 1               
0002F9r 1  A0 02        LE2F9:           ldy     #$02              ;move two bytes
0002FBr 1  B1 E0        LE2FB:           lda     (PX),y
0002FDr 1  99 CD 00                     sta     ACC-1,y
000300r 1  88                           dey
000301r 1  D0 F8                        bne     LE2FB
000303r 1  20 rr rr                     jsr     LE38A
000306r 1  A5 F1                        lda     TOKNDX
000308r 1  E5 C8                        sbc     TXTNDX
00030Ar 1  C9 04                        cmp     #$04
00030Cr 1  F0 A8                        beq     LE2B6
00030Er 1  91 E0                        sta     (PX),y
000310r 1  A5 CA                        lda     PP                ;P2 = PP - (PX),Y
000312r 1  F1 E0                        sbc     (PX),y
000314r 1  85 E4                        sta     P2
000316r 1  A5 CB                        lda     PP+1
000318r 1  E9 00                        sbc     #$00
00031Ar 1  85 E5                        sta     P2+1
00031Cr 1  A5 E4                        lda     P2
00031Er 1  C5 CC                        cmp     PV
000320r 1  A5 E5                        lda     P2+1
000322r 1  E5 CD                        sbc     PV+1
000324r 1  90 45                        bcc     MEMFULL
000326r 1  A5 CA        LE326:           lda     PP                ;P3 = PP - (PX),Y
000328r 1  F1 E0                        sbc     (PX),y
00032Ar 1  85 E6                        sta     P3
00032Cr 1  A5 CB                        lda     PP+1
00032Er 1  E9 00                        sbc     #$00
000330r 1  85 E7                        sta     P3+1
000332r 1  B1 CA                        lda     (PP),y
000334r 1  91 E6                        sta     (P3),y
000336r 1  E6 CA                        inc     PP
000338r 1  D0 02                        bne     LE33C
00033Ar 1  E6 CB                        inc     PP+1
00033Cr 1  A5 E2        LE33C:           lda     P1
00033Er 1  C5 CA                        cmp     PP
000340r 1  A5 E3                        lda     P1+1
000342r 1  E5 CB                        sbc     PP+1
000344r 1  B0 E0                        bcs     LE326
000346r 1  B5 E4        LE346:           lda     P2,x
000348r 1  95 CA                        sta     PP,x
00034Ar 1  CA                           dex
00034Br 1  10 F9                        bpl     LE346
00034Dr 1  B1 E0                        lda     (PX),y
00034Fr 1  A8                           tay
000350r 1  88           LE350:           dey
000351r 1  B1 E0                        lda     (PX),y
000353r 1  91 E6                        sta     (P3),y
000355r 1  98                           tya
000356r 1  D0 F8                        bne     LE350
000358r 1  24 F8                        bit     AUTOFLAG          ;auto line?
00035Ar 1  10 09                        bpl     LE365             ;no, branch
00035Cr 1  B5 F7        Loop16:           lda     AUTOLN+1,x        ;AUTOLN = AUTOLN + AUTOINC
00035Er 1  75 F5                        adc     AUTOINC+1,x
000360r 1  95 F7                        sta     AUTOLN+1,x
000362r 1  E8                           inx
000363r 1  F0 F7                        beq     Loop16
000365r 1  10 7E        LE365:           bpl     LE3E5
000367r 1  00                           brk
000368r 1               
000368r 1  00 00 00              .byte  $00,$00,$00
00036Br 1               
00036Br 1  A0 rr        MEMFULL:         ldy     #<ErrMsg03        ;"MEM FULL"
00036Dr 1  D0 71                        bne     ERRMESS           ;(always)
00036Fr 1               
00036Fr 1               ;
00036Fr 1               ; Token $0a ,
00036Fr 1               ;   DEL 0,10
00036Fr 1               ;
00036Fr 1  20 rr rr     COMMA_DEL:       jsr     GET16BIT
000372r 1  A5 E2                        lda     P1                ;P3 = P1
000374r 1  85 E6                        sta     P3
000376r 1  A5 E3                        lda     P1+1
000378r 1  85 E7                        sta     P3+1
00037Ar 1  20 rr rr                     jsr     LE575
00037Dr 1  A5 E2                        lda     P1                ;P2 = P1
00037Fr 1  85 E4                        sta     P2
000381r 1  A5 E3                        lda     P1+1
000383r 1  85 E5                        sta     P2+1
000385r 1  D0 0E                        bne     LE395             ;(always?)
000387r 1               ;
000387r 1               ; Token $09 DEL
000387r 1               ;
000387r 1  20 rr rr     DEL:             jsr     GET16BIT
00038Ar 1  20 rr rr     LE38A:           jsr     LE56D
00038Dr 1  A5 E6                        lda     P3                ;P1 = P3
00038Fr 1  85 E2                        sta     P1
000391r 1  A5 E7                        lda     P3+1
000393r 1  85 E3                        sta     P1+1
000395r 1               ; Memory move: P3 < PP.P2 backwards.
000395r 1  A0 00        LE395:           ldy     #$00
000397r 1  A5 CA        Loop18:          lda     PP
000399r 1  C5 E4                        cmp     P2
00039Br 1  A5 CB                        lda     PP+1
00039Dr 1  E5 E5                        sbc     P2+1
00039Fr 1  B0 16                        bcs     LE3B7
0003A1r 1  A5 E4                        lda     P2
0003A3r 1  D0 02                        bne     LE3A7
0003A5r 1  C6 E5                        dec     P2+1
0003A7r 1  C6 E4        LE3A7:           dec     P2
0003A9r 1  A5 E6                        lda     P3
0003ABr 1  D0 02                        bne     LE3AF
0003ADr 1  C6 E7                        dec     P3+1
0003AFr 1  C6 E6        LE3AF:           dec     P3
0003B1r 1  B1 E4                        lda     (P2),y
0003B3r 1  91 E6                        sta     (P3),y
0003B5r 1  90 E0                        bcc     Loop18
0003B7r 1               
0003B7r 1  A5 E6        LE3B7:          lda     P3                ;PP = P3
0003B9r 1  85 CA                        sta     PP
0003BBr 1  A5 E7                        lda     P3+1
0003BDr 1  85 CB                        sta     PP+1
0003BFr 1  60                           rts
0003C0r 1               
0003C0r 1  20 rr rr     Loop19:         jsr     MON_COUT          ;print error message
0003C3r 1  C8                           iny
0003C4r 1               ;
0003C4r 1               ; Print error message routine entry point.
0003C4r 1               ;
0003C4r 1  B9 rr rr     ERRORMESS:      lda     ErrMsg00,y
0003C7r 1  30 F7                        bmi     Loop19
0003C9r 1  09 80                        ora     #$80
0003CBr 1  4C rr rr                     jmp     MON_COUT
0003CEr 1               
0003CEr 1  98           GETCMD:         tya
0003CFr 1  AA                           tax
0003D0r 1  20 75 FD                     jsr     MON_NXTCHAR
0003D3r 1  8A                           txa
0003D4r 1  A8                           tay
0003D5r 1  A9 5F                        lda     #'_'              ;underline problem?
0003D7r 1  99 00 02                     sta     IN,y
0003DAr 1  A2 FF                        ldx     #$ff
0003DCr 1  60                           rts
0003DDr 1               
0003DDr 1  60                           .byte    $60
0003DEr 1               
0003DEr 1  A0 rr        ErrTooLong:     ldy     #<ErrMsg01        ;"TOO LONG"
0003E0r 1               ;
0003E0r 1               ; Print error message and goto mainline.
0003E0r 1               ;
0003E0r 1  20 rr rr     ERRMESS:         jsr     PRINTERR
0003E3r 1               ; DOS 3.3 chains here when processing errors.
0003E3r 1  24 D9                        bit     RUNFLAG
0003E5r 1  30 03        LE3E5:           bmi     LE3EA
0003E7r 1  4C rr rr                     jmp     LE2B6
0003EAr 1               
0003EAr 1  4C rr rr     LE3EA:           jmp     LEB9A
0003EDr 1               
0003EDr 1  2A           LE3ED:           rol     A
0003EEr 1  69 A0                        adc     #$a0
0003F0r 1  DD 00 02                     cmp     IN,x
0003F3r 1  D0 53                        bne     LE448
0003F5r 1  B1 FE                        lda     (SYNPAG),y
0003F7r 1  0A                           asl     A
0003F8r 1  30 06                        bmi     LE400
0003FAr 1  88                           dey
0003FBr 1  B1 FE                        lda     (SYNPAG),y
0003FDr 1  30 29                        bmi     LE428
0003FFr 1  C8                           iny
000400r 1  86 C8        LE400:           stx     TXTNDX
000402r 1  98                           tya
000403r 1  48                           pha
000404r 1  A2 00                        ldx     #$00
000406r 1  A1 FE                        lda     (SYNPAG,x)
000408r 1  AA                           tax
000409r 1  4A           Loop20:           lsr     A
00040Ar 1  49 40                        eor     #$40
00040Cr 1  11 FE                        ora     (SYNPAG),y
00040Er 1  C9 C0                        cmp     #$c0
000410r 1  90 01                        bcc     LE413
000412r 1  E8                           inx
000413r 1  C8           LE413:          iny
000414r 1  D0 F3                        bne     Loop20
000416r 1  68                           pla
000417r 1  A8                           tay
000418r 1  8A                           txa
000419r 1  4C rr rr                     jmp     LF2F8
00041Cr 1               
00041Cr 1  E6 F1        LE41C:           inc     TOKNDX
00041Er 1  A6 F1                        ldx     TOKNDX
000420r 1  F0 BC                        beq     ErrTooLong
000422r 1  9D 00 02                     sta     IN,x
000425r 1  60           Rtn7:         rts
000426r 1               
000426r 1  A6 C8        LE426:           ldx     TXTNDX
000428r 1  A9 A0        LE428:           lda     #BLANK+128
00042Ar 1  E8           LE42A:           inx
00042Br 1  DD 00 02                     cmp     IN,x
00042Er 1  B0 FA                        bcs     LE42A
000430r 1  B1 FE                        lda     (SYNPAG),y
000432r 1  29 3F                        and     #$3f
000434r 1  4A                           lsr     A
000435r 1  D0 B6                        bne     LE3ED
000437r 1  BD 00 02                     lda     IN,x
00043Ar 1  B0 06                        bcs     LE442
00043Cr 1  69 3F                        adc     #$3f
00043Er 1  C9 1A                        cmp     #$1a
000440r 1  90 6F                        bcc     LE4B1
000442r 1  69 4F        LE442:           adc     #$4f
000444r 1  C9 0A                        cmp     #$0a
000446r 1  90 69                        bcc     LE4B1
000448r 1  A6 FD        LE448:           ldx     SYNSTKDX
00044Ar 1  C8           Loop21:          iny
00044Br 1  B1 FE                        lda     (SYNPAG),y
00044Dr 1  29 E0                        and     #$e0
00044Fr 1  C9 20                        cmp     #$20
000451r 1  F0 7A                        beq     LE4CD
000453r 1  B5 A8                        lda     TXTNDXSTK,x
000455r 1  85 C8                        sta     TXTNDX
000457r 1  B5 D1                        lda     TOKNDXSTK,x
000459r 1  85 F1                        sta     TOKNDX
00045Br 1  88           Loop22:         dey
00045Cr 1  B1 FE                        lda     (SYNPAG),y
00045Er 1  0A                           asl     A                 ;double
00045Fr 1  10 FA                        bpl     Loop22
000461r 1  88                           dey
000462r 1  B0 38                        bcs     LE49C
000464r 1  0A                           asl     A
000465r 1  30 35                        bmi     LE49C
000467r 1  B4 58                        ldy     SYNSTKH,x
000469r 1  84 FF                        sty     SYNPAG+1
00046Br 1  B4 80                        ldy     SYNSTKL,x
00046Dr 1  E8                           inx
00046Er 1  10 DA                        bpl     Loop21
000470r 1  F0 B3        LE470:           beq     Rtn7
000472r 1  C9 7E                        cmp     #$7e
000474r 1  B0 22                        bcs     LE498
000476r 1  CA                           dex
000477r 1  10 04                        bpl     LE47D
000479r 1  A0 rr                        ldy     #<ErrMsg04        ;"TOO LONG"  (was ErrMsg01)
00047Br 1               ; BUG: above line should be ErrMsg04, "TOO MANY PARENS".  See Call-A.P.P.L.E.
00047Br 1               ; Mar 1983 p.114.
00047Br 1  10 29                        bpl     LE4A6             ;(always)
00047Dr 1               
00047Dr 1  94 80        LE47D:           sty     SYNSTKL,x
00047Fr 1  A4 FF                        ldy     SYNPAG+1
000481r 1  94 58                        sty     SYNSTKH,x
000483r 1  A4 C8                        ldy     TXTNDX
000485r 1  94 A8                        sty     TXTNDXSTK,x
000487r 1  A4 F1                        ldy     TOKNDX
000489r 1  94 D1                        sty     TOKNDXSTK,x
00048Br 1  29 1F                        and     #$1f
00048Dr 1  A8                           tay
00048Er 1  B9 rr rr                     lda     SYNTABLNDX,y
000491r 1  0A           LE491:           asl     A                 ;double
000492r 1  A8                           tay
000493r 1  A9 rr                        lda     #>SYNTABL/2     ;[#>SYNTABL/2] was SYNTABL-$7600
000495r 1  2A                           rol     A
000496r 1  85 FF                        sta     SYNPAG+1
000498r 1  D0 01        LE498:           bne     LE49B
00049Ar 1  C8                           iny
00049Br 1  C8           LE49B:           iny
00049Cr 1  86 FD        LE49C:           stx     SYNSTKDX
00049Er 1  B1 FE                        lda     (SYNPAG),y
0004A0r 1  30 84                        bmi     LE426
0004A2r 1  D0 05                        bne     LE4A9
0004A4r 1  A0 rr                        ldy     #<ErrMsg02        ;"SYNTAX"
0004A6r 1  4C rr rr     LE4A6:           jmp     ERRMESS
0004A9r 1               
0004A9r 1  C9 03        LE4A9:           cmp     #$03
0004ABr 1  B0 C3                        bcs     LE470
0004ADr 1  4A                           lsr     A                 ;halve
0004AEr 1  A6 C8                        ldx     TXTNDX
0004B0r 1  E8                           inx
0004B1r 1  BD 00 02     LE4B1:           lda     IN,x
0004B4r 1  90 04                        bcc     LE4BA
0004B6r 1  C9 A2                        cmp     #DQT+128
0004B8r 1  F0 0A                        beq     LE4C4
0004BAr 1  C9 5F        LE4BA:           cmp     #'_'              ;underline problem?
0004BCr 1  F0 06                        beq     LE4C4
0004BEr 1  86 C8                        stx     TXTNDX
0004C0r 1  20 rr rr     LE4C0:           jsr     LE41C
0004C3r 1  C8                           iny
0004C4r 1  88           LE4C4:           dey
0004C5r 1  A6 FD                        ldx     SYNSTKDX
0004C7r 1  B1 FE        Loop23:           lda     (SYNPAG),y
0004C9r 1  88                           dey
0004CAr 1  0A                           asl     A
0004CBr 1  10 CF                        bpl     LE49C
0004CDr 1  B4 58        LE4CD:           ldy     SYNSTKH,x
0004CFr 1  84 FF                        sty     SYNPAG+1
0004D1r 1  B4 80                        ldy     SYNSTKL,x
0004D3r 1  E8                           inx
0004D4r 1  B1 FE                        lda     (SYNPAG),y
0004D6r 1  29 9F                        and     #%10011111
0004D8r 1  D0 ED                        bne     Loop23
0004DAr 1  85 F2                        sta     PCON
0004DCr 1  85 F3                        sta     PCON+1
0004DEr 1  98                           tya
0004DFr 1  48                           pha
0004E0r 1  86 FD                        stx     SYNSTKDX
0004E2r 1  B4 D0                        ldy     TOKNDXSTK-1,x
0004E4r 1  84 C9                        sty     LEADBL
0004E6r 1  18                           clc
0004E7r 1  A9 0A        Loop24:          lda     #$0a
0004E9r 1  85 F9                        sta     CHAR
0004EBr 1  A2 00                        ldx     #$00
0004EDr 1  C8                           iny
0004EEr 1  B9 00 02                     lda     IN,y
0004F1r 1  29 0F                        and     #$0f
0004F3r 1  65 F2        Loop25:          adc     PCON
0004F5r 1  48                           pha
0004F6r 1  8A                           txa
0004F7r 1  65 F3                        adc     PCON+1
0004F9r 1  30 1C                        bmi     LE517
0004FBr 1  AA                           tax
0004FCr 1  68                           pla
0004FDr 1  C6 F9                        dec     CHAR
0004FFr 1  D0 F2                        bne     Loop25
000501r 1  85 F2                        sta     PCON
000503r 1  86 F3                        stx     PCON+1
000505r 1  C4 F1                        cpy     TOKNDX
000507r 1  D0 DE                        bne     Loop24
000509r 1  A4 C9                        ldy     LEADBL
00050Br 1  C8                           iny
00050Cr 1  84 F1                        sty     TOKNDX
00050Er 1  20 rr rr                     jsr     LE41C
000511r 1  68                           pla
000512r 1  A8                           tay
000513r 1  A5 F3                        lda     PCON+1
000515r 1  B0 A9                        bcs     LE4C0
000517r 1  A0 rr        LE517:           ldy     #<ErrMsg00        ;">32767"
000519r 1  10 8B                        bpl     LE4A6             ;(always)
00051Br 1               
00051Br 1               ;
00051Br 1               ; Prints a 16-bit number in decimal.
00051Br 1               ;
00051Br 1               ; On entry:
00051Br 1               ;   A-reg: high byte
00051Br 1               ;   X-reg: low byte
00051Br 1               ;
00051Br 1  85 F3        PRDEC:           sta     PCON+1
00051Dr 1  86 F2                        stx     PCON
00051Fr 1  A2 04                        ldx     #$04
000521r 1  86 C9                        stx     LEADBL
000523r 1  A9 30        Loop26:          lda     #'0'
000525r 1  85 F9                        sta     CHAR
000527r 1  A5 F2        Loop27:          lda     PCON
000529r 1  DD rr rr                     cmp     NUMLOW,x
00052Cr 1  A5 F3                        lda     PCON+1
00052Er 1  FD rr rr                     sbc     NUMHI,x
000531r 1  90 0D                        bcc     LE540
000533r 1  85 F3                        sta     PCON+1
000535r 1  A5 F2                        lda     PCON
000537r 1  FD rr rr                     sbc     NUMLOW,x
00053Ar 1  85 F2                        sta     PCON
00053Cr 1  E6 F9                        inc     CHAR
00053Er 1  D0 E7                        bne     Loop27
000540r 1  A5 F9        LE540:           lda     CHAR
000542r 1  E8                           inx
000543r 1  CA                           dex
000544r 1  F0 0E                        beq     PRDEC5
000546r 1  C9 30                        cmp     #'0'
000548r 1  F0 02                        beq     LE54C
00054Ar 1  85 C9                        sta     LEADBL
00054Cr 1  24 C9        LE54C:          bit     LEADBL
00054Er 1  30 04                        bmi     PRDEC5
000550r 1  A5 FA                        lda     LEADZR
000552r 1  F0 0B                        beq     PRDEC6
000554r 1               ; PRINT
000554r 1  20 rr rr     PRDEC5:          jsr     MON_COUT
000557r 1  24 F8                        bit     AUTOFLAG          ;auto line?
000559r 1  10 04                        bpl     PRDEC6
00055Br 1  99 00 02                     sta     IN,y
00055Er 1  C8                           iny
00055Fr 1               ; NXTX
00055Fr 1  CA           PRDEC6:          dex
000560r 1  10 C1                        bpl     Loop26
000562r 1  60                           rts
000563r 1               
000563r 1  01           NUMLOW:          .byte    1                 ;1
000564r 1  0A                           .byte   10                ;10
000565r 1  64                           .byte   100               ;100
000566r 1  E8                           .byte    $e8               ;1000 ($3e8)
000567r 1  10                           .byte    $10               ;10000 ($2710
000568r 1  00           NUMHI:           .byte    0                 ;1
000569r 1  00                           .byte    0                 ;10
00056Ar 1  00                           .byte    0                 ;100
00056Br 1  03                           .byte   $03               ;1000 ($03e8)
00056Cr 1  27                           .byte    $27               ;10000 ($2710)
00056Dr 1               
00056Dr 1  A5 CA        LE56D:           lda     PP                ;P3 = PP
00056Fr 1  85 E6                        sta     P3
000571r 1  A5 CB                        lda     PP+1
000573r 1  85 E7                        sta     P3+1
000575r 1  E8           LE575:           inx
000576r 1  A5 E7        LE576:           lda     P3+1              ;P2 = P3
000578r 1  85 E5                        sta     P2+1
00057Ar 1  A5 E6                        lda     P3
00057Cr 1  85 E4                        sta     P2
00057Er 1  C5 4C                        cmp     HIMEM             ;compare P2 and HIMEM
000580r 1  A5 E5                        lda     P2+1
000582r 1  E5 4D                        sbc     HIMEM+1
000584r 1  B0 26                        bcs     Rtn8
000586r 1               ;
000586r 1  A0 01                        ldy     #$01
000588r 1  B1 E4                        lda     (P2),y
00058Ar 1  E5 CE                        sbc     ACC
00058Cr 1  C8                           iny
00058Dr 1  B1 E4                        lda     (P2),y
00058Fr 1  E5 CF                        sbc     ACC+1
000591r 1  B0 19                        bcs     Rtn8
000593r 1  A0 00                        ldy     #$00
000595r 1  A5 E6                        lda     P3                ;P3 = P3.W + (P2).B
000597r 1  71 E4                        adc     (P2),y
000599r 1  85 E6                        sta     P3
00059Br 1  90 03                        bcc     LE5A0
00059Dr 1  E6 E7                        inc     P3+1
00059Fr 1  18                           clc
0005A0r 1  C8           LE5A0:           iny
0005A1r 1  A5 CE                        lda     ACC               ;is ACC+1 <HS> (P2),Y?
0005A3r 1  F1 E4                        sbc     (P2),y
0005A5r 1  C8                           iny
0005A6r 1  A5 CF                        lda     ACC+1
0005A8r 1  F1 E4                        sbc     (P2),y
0005AAr 1  B0 CA                        bcs     LE576
0005ACr 1  60           Rtn8:        rts
0005ADr 1               
0005ADr 1               ;
0005ADr 1               ; Token $0b NEW
0005ADr 1               ;   turn off AUTO
0005ADr 1               ;   remove program
0005ADr 1               ;   fall into CLR
0005ADr 1               ;
0005ADr 1  46 F8        NEW:             lsr     AUTOFLAG          ;manual
0005AFr 1  A5 4C                        lda     HIMEM             ;PP = HIMEM
0005B1r 1  85 CA                        sta     PP
0005B3r 1  A5 4D                        lda     HIMEM+1
0005B5r 1  85 CB                        sta     PP+1
0005B7r 1               ;
0005B7r 1               ; Token $0c CLR
0005B7r 1               ;   remove variables
0005B7r 1               ;   remove FOR loops and GOSUBs
0005B7r 1               ;
0005B7r 1  A5 4A        CLR:             lda     LOMEM             ;PV = LOMEM
0005B9r 1  85 CC                        sta     PV
0005BBr 1  A5 4B                        lda     LOMEM+1
0005BDr 1  85 CD                        sta     PV+1
0005BFr 1  A9 00                        lda     #$00
0005C1r 1  85 FB                        sta     FORNDX            ;no FORs
0005C3r 1  85 FC                        sta     GOSUBNDX          ;no GOSUBs
0005C5r 1  85 FE                        sta     SYNPAG
0005C7r 1  A9 00                        lda     #$00              ;?
0005C9r 1  85 1D                        sta     $1d               ;?
0005CBr 1  60                           rts
0005CCr 1               
0005CCr 1  A5 D0        unref_e5cc:      lda     SRCH
0005CEr 1               ;
0005CEr 1  4C rr rr     ErrMemFull:      jmp     MEMFULL
0005D1r 1               
0005D1r 1  A0 FF        Loop30:         ldy     #$ff
0005D3r 1  84 D8        Loop31:         sty     XSAVE
0005D5r 1  C8           Loop33:         iny
0005D6r 1  B1 E0                        lda     (PX),y
0005D8r 1  30 06                        bmi     LE5E0
0005DAr 1  C9 40                        cmp     #$40
0005DCr 1  D0 68                        bne     LE646             ;exit loop
0005DEr 1  85 D8                        sta     XSAVE
0005E0r 1  D1 D0        LE5E0:           cmp     (SRCH),y
0005E2r 1  F0 F1                        beq     Loop33
0005E4r 1  B1 D0        LE5E4:           lda     (SRCH),y
0005E6r 1  C8           LE5E6:           iny
0005E7r 1  4A                           lsr     A
0005E8r 1  D0 FA                        bne     LE5E4
0005EAr 1  B1 D0                        lda     (SRCH),y
0005ECr 1  48                           pha
0005EDr 1  C8                           iny
0005EEr 1  B1 D0                        lda     (SRCH),y
0005F0r 1  A8                           tay
0005F1r 1  68                           pla
0005F2r 1  85 D0        LE5F2:           sta     SRCH
0005F4r 1  84 D1                        sty     SRCH+1
0005F6r 1  C5 CC                        cmp     PV
0005F8r 1  D0 D7                        bne     Loop30
0005FAr 1  C4 CD                        cpy     PV+1
0005FCr 1  D0 D3                        bne     Loop30
0005FEr 1  A0 00                        ldy     #$00
000600r 1  C8           Loop34:           iny
000601r 1  B1 E0                        lda     (PX),y
000603r 1  30 FB                        bmi     Loop34
000605r 1  49 40                        eor     #$40
000607r 1  F0 F7                        beq     Loop34
000609r 1  98                           tya
00060Ar 1  69 04                        adc     #$04
00060Cr 1  48                           pha
00060Dr 1  65 D0                        adc     SRCH
00060Fr 1  A8                           tay
000610r 1  A5 D1                        lda     SRCH+1
000612r 1  69 00                        adc     #$00
000614r 1  48                           pha
000615r 1  C4 CA                        cpy     PP
000617r 1  E5 CB                        sbc     PP+1
000619r 1  B0 B3                        bcs     ErrMemFull        ;"MEM FULL"
00061Br 1  84 CC                        sty     PV
00061Dr 1  68                           pla
00061Er 1  85 CD                        sta     PV+1
000620r 1  68                           pla
000621r 1  A8                           tay
000622r 1  A9 00                        lda     #$00
000624r 1  88                           dey
000625r 1  91 D0                        sta     (SRCH),y
000627r 1  88                           dey
000628r 1  91 D0                        sta     (SRCH),y
00062Ar 1  88                           dey
00062Br 1  A5 CD                        lda     PV+1
00062Dr 1  91 D0                        sta     (SRCH),y
00062Fr 1  88                           dey
000630r 1  A5 CC                        lda     PV
000632r 1  91 D0                        sta     (SRCH),y
000634r 1  88                           dey
000635r 1  A9 00                        lda     #$00
000637r 1  91 D0        Loop35:           sta     (SRCH),y
000639r 1  88                           dey
00063Ar 1  30 97                        bmi     Loop31
00063Cr 1  B1 E0                        lda     (PX),y
00063Er 1  D0 F7                        bne     Loop35             ;(always)
000640r 1               
000640r 1  A5 4A        LE640:           lda     LOMEM
000642r 1  A4 4B                        ldy     LOMEM+1
000644r 1  D0 AC                        bne     LE5F2             ;(always)
000646r 1               
000646r 1  B1 D0        LE646:           lda     (SRCH),y
000648r 1  C9 40                        cmp     #$40
00064Ar 1  B0 9A                        bcs     LE5E6
00064Cr 1  95 9F                        sta     NOUNSTKC-1,x
00064Er 1  98                           tya
00064Fr 1  69 03                        adc     #$03
000651r 1  48                           pha
000652r 1  65 D0                        adc     SRCH
000654r 1  20 rr rr                     jsr     LE70A
000657r 1  20 rr rr     Loop36:           jsr     GETVERB
00065Ar 1  88                           dey
00065Br 1  D0 FA                        bne     Loop36
00065Dr 1  98                           tya
00065Er 1  65 D1                        adc     SRCH+1
000660r 1  95 78                        sta     NOUNSTKH,x
000662r 1  68                           pla
000663r 1  24 D8                        bit     XSAVE
000665r 1  30 1D                        bmi     LE684
000667r 1  A8                           tay
000668r 1  A9 00                        lda     #$00
00066Ar 1  20 rr rr                     jsr     LE70A
00066Dr 1  95 78                        sta     NOUNSTKH,x
00066Fr 1  B1 D0        LE66F:          lda     (SRCH),y
000671r 1  10 0F                        bpl     LE682             ;exit loop
000673r 1  F6 78                        inc     NOUNSTKH,x
000675r 1  C8                           iny
000676r 1  D0 F7                        bne     LE66F             ;(always)
000678r 1               
000678r 1  09                    .byte    $09
000679r 1               
000679r 1  A9 00        LE679:           lda     #$00
00067Br 1  85 D4                        sta     IFFLAG
00067Dr 1  85 D5                        sta     CRFLAG
00067Fr 1  A2 20                        ldx     #$20
000681r 1  48           LE681:           pha
000682r 1  A0 00        LE682:           ldy     #$00
000684r 1  B1 E0        LE684:           lda     (PX),y
000686r 1  10 18        LE686:           bpl     LE6A0             ;exit loop
000688r 1  0A                           asl     A
000689r 1  30 B5                        bmi     LE640
00068Br 1  20 rr rr                     jsr     GETVERB
00068Er 1  20 rr rr                     jsr     LE708
000691r 1  20 rr rr                     jsr     GETVERB
000694r 1  95 A0                        sta     NOUNSTKC,x
000696r 1  24 D4        LE696:           bit     IFFLAG
000698r 1  10 01                        bpl     LE69B
00069Ar 1  CA                           dex
00069Br 1  20 rr rr     LE69B:           jsr     GETVERB
00069Er 1  B0 E6                        bcs     LE686
0006A0r 1  C9 28        LE6A0:           cmp     #$28
0006A2r 1  D0 1F                        bne     LE6C3
0006A4r 1  A5 E0                        lda     PX
0006A6r 1  20 rr rr                     jsr     LE70A
0006A9r 1  A5 E1                        lda     PX+1
0006ABr 1  95 78                        sta     NOUNSTKH,x
0006ADr 1  24 D4                        bit     IFFLAG
0006AFr 1  30 0B                        bmi     LE6BC
0006B1r 1  A9 01                        lda     #$01
0006B3r 1  20 rr rr                     jsr     LE70A
0006B6r 1  A9 00                        lda     #$00
0006B8r 1  95 78                        sta     NOUNSTKH,x
0006BAr 1  F6 78        Loop37:         inc     NOUNSTKH,x      ; Loop
0006BCr 1  20 rr rr     LE6BC:          jsr     GETVERB
0006BFr 1  30 F9                        bmi     Loop37
0006C1r 1  B0 D3                        bcs     LE696
0006C3r 1  24 D4        LE6C3:           bit     IFFLAG
0006C5r 1  10 06                        bpl     LE6CD
0006C7r 1  C9 04                        cmp     #$04
0006C9r 1  B0 D0                        bcs     LE69B
0006CBr 1  46 D4                        lsr     IFFLAG
0006CDr 1  A8           LE6CD:           tay
0006CEr 1  85 D6                        sta     VERBNOW
0006D0r 1  B9 rr rr                     lda     TABLE1,y
0006D3r 1  29 55                        and     #%01010101        ;even bits only
0006D5r 1  0A                           asl     A
0006D6r 1  85 D7                        sta     PRFLAG            ;temp
0006D8r 1  68           LE6D8:           pla
0006D9r 1  A8                           tay
0006DAr 1  B9 rr rr                     lda     TABLE1,y
0006DDr 1  29 AA                        and     #%10101010        ;odd bits only
0006DFr 1  C5 D7                        cmp     PRFLAG
0006E1r 1  B0 09                        bcs     LE6EC
0006E3r 1  98                           tya
0006E4r 1  48                           pha
0006E5r 1  20 rr rr                     jsr     LF3EB
0006E8r 1  A5 D6                        lda     VERBNOW
0006EAr 1  90 95                        bcc     LE681             ;(always)
0006ECr 1               ; BRANCH: get high/low then JSR.
0006ECr 1  B9 rr rr     LE6EC:           lda     VERBADRL,y
0006EFr 1  85 CE                        sta     ACC
0006F1r 1  B9 rr rr                     lda     VERBADRH,y
0006F4r 1  85 CF                        sta     ACC+1
0006F6r 1  20 rr rr                     jsr     LE6FC
0006F9r 1  4C rr rr                     jmp     LE6D8
0006FCr 1               
0006FCr 1  6C CE 00     LE6FC:           jmp     (ACC)
0006FFr 1               
0006FFr 1               ;
0006FFr 1               ; Get next verb to use.
0006FFr 1               ;
0006FFr 1  E6 E0        GETVERB:         inc     PX
000701r 1  D0 02                        bne     NoInc
000703r 1  E6 E1                        inc     PX+1
000705r 1  B1 E0        NoInc:          lda     (PX),y
000707r 1  60                           rts
000708r 1               
000708r 1  94 77        LE708:          sty     NOUNSTKH-1,x
00070Ar 1  CA           LE70A:          dex
00070Br 1  30 03                        bmi     LE710
00070Dr 1  95 50                        sta     NOUNSTKL,x
00070Fr 1  60                           rts
000710r 1               
000710r 1  A0 rr        LE710:          ldy     #<ErrMsg12+3      ;"PPED AT"
000712r 1  4C rr rr     LE712:          jmp     ERRMESS
000715r 1               
000715r 1               ;
000715r 1               ; Get a 16-bit value.
000715r 1               ;
000715r 1  A0 00        GET16BIT:        ldy     #$00
000717r 1  B5 50                        lda     NOUNSTKL,x
000719r 1  85 CE                        sta     ACC
00071Br 1  B5 A0                        lda     NOUNSTKC,x
00071Dr 1  85 CF                        sta     ACC+1
00071Fr 1  B5 78                        lda     NOUNSTKH,x
000721r 1  F0 0E                        beq     LE731
000723r 1  85 CF                        sta     ACC+1
000725r 1  B1 CE                        lda     (ACC),y           ;ACC = (ACC),Y
000727r 1  48                           pha                       ;save low byte
000728r 1  C8                           iny                       ;Y-reg = 1
000729r 1  B1 CE                        lda     (ACC),y
00072Br 1  85 CF                        sta     ACC+1
00072Dr 1  68                           pla                       ;restore low byte
00072Er 1  85 CE                        sta     ACC
000730r 1  88                           dey                       ;Y-reg = 0
000731r 1  E8           LE731:          inx
000732r 1  60                           rts
000733r 1               
000733r 1               ;
000733r 1               ; Token $16 =
000733r 1               ;   num var logic op
000733r 1               ;   IF X = 13 THEN END
000733r 1               ;
000733r 1  20 rr rr     TE733:           jsr     TE74A
000736r 1               ;
000736r 1               ; Token $37 NOT
000736r 1               ;   numeric
000736r 1               ;   IF NOT X THEN END
000736r 1               ;
000736r 1  20 rr rr     NOT:             jsr     GET16BIT
000739r 1  98                           tya                       ;A-reg = 0
00073Ar 1  20 rr rr                     jsr     LE708
00073Dr 1  95 A0                        sta     NOUNSTKC,x
00073Fr 1  C5 CE                        cmp     ACC
000741r 1  D0 06                        bne     Rtn9
000743r 1  C5 CF                        cmp     ACC+1
000745r 1  D0 02                        bne     Rtn9
000747r 1  F6 50                        inc     NOUNSTKL,x
000749r 1  60           Rtn9:        rts
00074Ar 1               
00074Ar 1               ;
00074Ar 1               ; Token $17 #
00074Ar 1               ;   num var logic op
00074Ar 1               ;   IF X # 13 THEN END
00074Ar 1               ;
00074Ar 1               ; Token $1b <>
00074Ar 1               ;   num var logic op
00074Ar 1               ;   IF X <> 13 THEN END
00074Ar 1               ;
00074Ar 1  20 rr rr     TE74A:           jsr     SUBTRACT
00074Dr 1  20 rr rr                     jsr     SGN
000750r 1               ;
000750r 1               ; Token $31 ABS
000750r 1               ;
000750r 1  20 rr rr     ABS:             jsr     GET16BIT
000753r 1  24 CF                        bit     ACC+1
000755r 1  30 1B                        bmi     LE772
000757r 1  CA           LE757:           dex
000758r 1  60           Rtn10:          rts
000759r 1               
000759r 1               ;
000759r 1               ; Token $30 SGN
000759r 1               ;
000759r 1  20 rr rr     SGN:             jsr     GET16BIT
00075Cr 1  A5 CF                        lda     ACC+1             ;is ACC zero?
00075Er 1  D0 04                        bne     LE764
000760r 1  A5 CE                        lda     ACC
000762r 1  F0 F3                        beq     LE757             ;yes
000764r 1  A9 FF        LE764:           lda     #$ff
000766r 1  20 rr rr                     jsr     LE708
000769r 1  95 A0                        sta     NOUNSTKC,x
00076Br 1  24 CF                        bit     ACC+1
00076Dr 1  30 E9                        bmi     Rtn10
00076Fr 1               ;
00076Fr 1               ; Token $36 -
00076Fr 1               ;   unary sign of number
00076Fr 1               ;   X = -5
00076Fr 1               ;
00076Fr 1  20 rr rr     NEGATE:          jsr     GET16BIT
000772r 1  98           LE772:           tya                       ;A-reg = 0
000773r 1  38                           sec
000774r 1  E5 CE                        sbc     ACC
000776r 1  20 rr rr                     jsr     LE708
000779r 1  98                           tya
00077Ar 1  E5 CF                        sbc     ACC+1
00077Cr 1  50 23                        bvc     LE7A1
00077Er 1  A0 rr        Err32767:        ldy     #<ErrMsg00        ;">32767"
000780r 1  10 90                        bpl     LE712             ;(always)
000782r 1               
000782r 1               ;
000782r 1               ; Token $13 -
000782r 1               ;   num op
000782r 1               ;   X = 27 - 2
000782r 1               ;
000782r 1  20 rr rr     SUBTRACT:        jsr     NEGATE            ;negate, then add
000785r 1               ;
000785r 1               ; Token $12 +
000785r 1               ;   num op
000785r 1               ;   X = 27 + 2
000785r 1               ;
000785r 1  20 rr rr     TE785:          jsr     GET16BIT
000788r 1  A5 CE                        lda     ACC               ;AUX = ACC
00078Ar 1  85 DA                        sta     AUX
00078Cr 1  A5 CF                        lda     ACC+1
00078Er 1  85 DB                        sta     AUX+1
000790r 1  20 rr rr                     jsr     GET16BIT
000793r 1  18           LE793:          clc
000794r 1  A5 CE                        lda     ACC
000796r 1  65 DA                        adc     AUX
000798r 1  20 rr rr                     jsr     LE708
00079Br 1  A5 CF                        lda     ACC+1
00079Dr 1  65 DB                        adc     AUX+1
00079Fr 1  70 DD                        bvs     Err32767
0007A1r 1  95 A0        LE7A1:          sta     NOUNSTKC,x
0007A3r 1               ;
0007A3r 1               ; Token $35 +
0007A3r 1               ;   unary sign of number
0007A3r 1               ;   X = +5
0007A3r 1               ;
0007A3r 1  60           POSITIVE:       rts
0007A4r 1               
0007A4r 1               ;
0007A4r 1               ; Token $50 TAB
0007A4r 1               ;
0007A4r 1  20 rr rr     TAB:            jsr     GETBYTE
0007A7r 1  A8                           tay
0007A8r 1  D0 03                        bne     LE7AD
0007AAr 1  4C rr rr                     jmp     BcsRANGERR        ;range error?
0007ADr 1               
0007ADr 1  88           LE7AD:          dey
0007AEr 1  4C rr rr     LE7AE:          jmp     LF3F4
0007B1r 1               
0007B1r 1               ;
0007B1r 1               ; Comma tab to next tab posn (every 8 spaces).
0007B1r 1               ;
0007B1r 1  A5 24        LE7B1:          lda     MON_CH            ;get horiz posn
0007B3r 1  09 07                        ora     #$07              ;set bits 0-2
0007B5r 1  A8                           tay
0007B6r 1  C8                           iny                       ;incr, is it zero? [only if CH=$f8-ff (invalid)]
0007B7r 1  D0 F5        Loop38:         bne     LE7AE             ;no, adjust CH [always?]
0007B9r 1  C8                           iny                       ;yes, go to next tab posn [sets Y-reg=1]
0007BAr 1  D0 F5                        bne     LE7B1             ;(always)
0007BCr 1               
0007BCr 1  B0 F9        unref_e7bc:     bcs     Loop38
0007BEr 1  60                           rts
0007BFr 1               
0007BFr 1  00 00                        .byte   $00,$00
0007C1r 1               
0007C1r 1               ;
0007C1r 1               ; Token $49 ,
0007C1r 1               ;   num print follows
0007C1r 1               ;   PRINT A$,X
0007C1r 1               ;
0007C1r 1  20 rr rr     TE7C1:           jsr     LE7B1
0007C4r 1               ;
0007C4r 1               ; Token $46 ;
0007C4r 1               ;   num print follows
0007C4r 1               ;   PRINT A$ ; X
0007C4r 1               ;
0007C4r 1               ; Token $62 PRINT
0007C4r 1               ;   num value
0007C4r 1               ;   PRINT 123: PRINT X: PRINT ASC(A$)
0007C4r 1               ;
0007C4r 1  20 rr rr     PRINTNUM:        jsr     GET16BIT
0007C7r 1  A5 CF        LE7C7:           lda     ACC+1             ;is it positive?
0007C9r 1  10 0A                        bpl     LE7D5
0007CBr 1  A9 2D                        lda     #'-'              ;no, print minus sign
0007CDr 1  20 rr rr                     jsr     MON_COUT
0007D0r 1  20 rr rr                     jsr     LE772
0007D3r 1  50 EF                        bvc     PRINTNUM          ;(always)
0007D5r 1               
0007D5r 1  88           LE7D5:           dey                       ;Y-reg = $ff
0007D6r 1  84 D5                        sty     CRFLAG            ;CRFLAG = $ff
0007D8r 1  86 CF                        stx     ACC+1             ;save X-reg
0007DAr 1  A6 CE                        ldx     ACC
0007DCr 1  20 rr rr                     jsr     PRDEC
0007DFr 1  A6 CF                        ldx     ACC+1             ;restore X-reg
0007E1r 1  60                           rts
0007E2r 1               
0007E2r 1               ;
0007E2r 1               ; Token $0d AUTO
0007E2r 1               ;
0007E2r 1  20 rr rr     AUTO:            jsr     GET16BIT
0007E5r 1  A5 CE                        lda     ACC               ;AUTOLN = ACC
0007E7r 1  85 F6                        sta     AUTOLN
0007E9r 1  A5 CF                        lda     ACC+1
0007EBr 1  85 F7                        sta     AUTOLN+1
0007EDr 1  88                           dey
0007EEr 1  84 F8                        sty     AUTOFLAG          ;AUTOFLAG = $ff
0007F0r 1  C8                           iny
0007F1r 1  A9 0A                        lda     #10               ;default increment
0007F3r 1  85 F4        LE7F3:           sta     AUTOINC
0007F5r 1  84 F5                        sty     AUTOINC+1
0007F7r 1  60                           rts
0007F8r 1               
0007F8r 1               ;
0007F8r 1               ; Token $0e ,
0007F8r 1               ;   AUTO 10,20
0007F8r 1               ;
0007F8r 1  20 rr rr     COMMA_AUTO:      jsr     GET16BIT
0007FBr 1  A5 CE                        lda     ACC
0007FDr 1  A4 CF                        ldy     ACC+1
0007FFr 1  10 F2                        bpl     LE7F3             ;(always)
000801r 1               
000801r 1               ;
000801r 1               ; Token $56 =
000801r 1               ;   FOR X = 5 TO 10
000801r 1               ;
000801r 1               ; Token $71 =
000801r 1               ;   num - non-conditional
000801r 1               ;   X = 5
000801r 1               ;
000801r 1  20 rr rr     TE801:           jsr     GET16BIT
000804r 1  B5 50                        lda     NOUNSTKL,x
000806r 1  85 DA                        sta     AUX
000808r 1  B5 78                        lda     NOUNSTKH,x
00080Ar 1  85 DB                        sta     AUX+1
00080Cr 1  A5 CE                        lda     ACC
00080Er 1  91 DA                        sta     (AUX),y
000810r 1  C8                           iny
000811r 1  A5 CF                        lda     ACC+1
000813r 1  4C rr rr                     jmp     LF207
000816r 1               
000816r 1               ;
000816r 1               ; Token $25 THEN
000816r 1               ;   IF X = 3 THEN Y = 5
000816r 1               ;
000816r 1               ; Token $5e LET
000816r 1               ;
000816r 1  60           LET:             rts
000817r 1               
000817r 1               ;
000817r 1               ; Token $00
000817r 1               ;   internal begin-of-line
000817r 1               ;
000817r 1  68           BEGIN_LINE:     pla
000818r 1  68                           pla
000819r 1               ;
000819r 1               ; Token $03 :
000819r 1               ;   statement separation
000819r 1               ;   X = 5: A$ = "HELLO"
000819r 1               ;
000819r 1  24 D5        COLON:          bit     CRFLAG
00081Br 1  10 05                        bpl     Rtn11
00081Dr 1               ;
00081Dr 1               ; Token $63 PRINT
00081Dr 1               ;   dummy print
00081Dr 1               ;   PRINT: PRINT
00081Dr 1               ;
00081Dr 1  20 rr rr     PRINT_CR:        jsr     MON_CROUT
000820r 1               ;
000820r 1               ; Token $47 ;
000820r 1               ;   end of print statement
000820r 1               ;   PRINT A$;
000820r 1               ;
000820r 1  46 D5        TE820:          lsr     CRFLAG
000822r 1  60           Rtn11:         rts
000823r 1               
000823r 1               ;
000823r 1               ; Token $22 (
000823r 1               ;   string DIM
000823r 1               ;   DIM A$(X)
000823r 1               ;
000823r 1               ; Token $34 (
000823r 1               ;   num DIM
000823r 1               ;   DIM X(5)
000823r 1               ;
000823r 1               ; Token $38 (
000823r 1               ;   logic statements and num operations
000823r 1               ;   IF C and (A=14 OR B=12) THEN X=(27+3)/13
000823r 1               ;
000823r 1               ; Token $3f (
000823r 1               ;   used after PEEK, RND, SGN, ABS, and PDL
000823r 1               ;
000823r 1  A0 FF        TE823:          ldy     #$ff
000825r 1  84 D7                        sty     PRFLAG            ;PRFLAG = $ff
000827r 1               ;
000827r 1               ; Token $72 )
000827r 1               ;   the only right parenthesis token
000827r 1               ;
000827r 1  60           RIGHT_PAREN:     rts
000828r 1               
000828r 1               ;
000828r 1               ; Token $60 IF
000828r 1               ;
000828r 1  20 rr rr     IF:             jsr     LEFCD
00082Br 1  F0 07                        beq     LE834
00082Dr 1  A9 25                        lda     #$25              ;THEN token?
00082Fr 1  85 D6                        sta     VERBNOW
000831r 1  88                           dey
000832r 1  84 D4                        sty     IFFLAG
000834r 1  E8           LE834:          inx
000835r 1  60                           rts
000836r 1               
000836r 1               ;
000836r 1               ; Run without CLR
000836r 1               ;   DOS 3.3 chains here to run a program
000836r 1               ;
000836r 1  A5 CA        RUNWARM:        lda     PP
000838r 1  A4 CB                        ldy     PP+1
00083Ar 1  D0 5A                        bne     LE896             ;(always)
00083Cr 1               
00083Cr 1               ;
00083Cr 1               ; Token $5c GOSUB
00083Cr 1               ;
00083Cr 1  A0 rr        GOSUB:          ldy     #<ErrMsg08        ;"16 GOSUBS"
00083Er 1  A5 FC                        lda     GOSUBNDX
000840r 1  C9 10                        cmp     #16               ;sixteen GOSUBs?
000842r 1  B0 5E                        bcs     JmpERRMESS1       ;yes, error
000844r 1  A8                           tay
000845r 1  E6 FC                        inc     GOSUBNDX
000847r 1               ;
000847r 1  A5 E0                        lda     PX
000849r 1  99 00 01                     sta     STK_00,y
00084Cr 1  A5 E1                        lda     PX+1
00084Er 1  99 10 01                     sta     STK_10,y
000851r 1               ;
000851r 1  A5 DC                        lda     PR
000853r 1  99 20 01                     sta     STK_20,y
000856r 1  A5 DD                        lda     PR+1
000858r 1  99 30 01                     sta     STK_30,y
00085Br 1               ;
00085Br 1               ; Token $24 THEN
00085Br 1               ;   followed by a line number
00085Br 1               ;   IF X=3 THEN 10
00085Br 1               ;
00085Br 1               ; Token $5f GOTO
00085Br 1               ;
00085Br 1  20 rr rr     GOTO:           jsr     GET16BIT
00085Er 1  20 rr rr                     jsr     LE56D
000861r 1  90 04                        bcc     LE867
000863r 1  A0 rr                        ldy     #<ErrMsg07        ;"BAD BRANCH"
000865r 1  D0 3B                        bne     JmpERRMESS1
000867r 1               
000867r 1  A5 E4        LE867:          lda     P2
000869r 1  A4 E5                        ldy     P2+1
00086Br 1               ; Main loop for running Integer BASIC programs.
00086Br 1  85 DC        LE86B:          sta     PR
00086Dr 1  84 DD                        sty     PR+1
00086Fr 1  18                           clc
000870r 1  69 03                        adc     #$03
000872r 1  90 01                        bcc     GETNEXT
000874r 1  C8                           iny
000875r 1               ; Fetch next statement from text source.
000875r 1  A2 FF        GETNEXT:        ldx     #$ff
000877r 1  86 D9                        stx     RUNFLAG
000879r 1  9A                           txs
00087Ar 1  85 E0                        sta     PX
00087Cr 1  84 E1                        sty     PX+1
00087Er 1  20 rr rr                     jsr     LF02E             ;test for Ctrl+C and TRACE mode
000881r 1  A0 00                        ldy     #$00
000883r 1  20 rr rr     LE883:          jsr     LE679             ;execute statement
000886r 1  24 D9                        bit     RUNFLAG
000888r 1  10 48                        bpl     END
00088Ar 1  18                           clc
00088Br 1  A0 00                        ldy     #$00
00088Dr 1  A5 DC                        lda     PR
00088Fr 1  71 DC                        adc     (PR),y
000891r 1  A4 DD                        ldy     PR+1
000893r 1  90 01                        bcc     LE896
000895r 1  C8                           iny
000896r 1  C5 4C        LE896:          cmp     HIMEM
000898r 1  D0 D1                        bne     LE86B
00089Ar 1  C4 4D                        cpy     HIMEM+1
00089Cr 1  D0 CD                        bne     LE86B
00089Er 1  A0 rr                        ldy     #<ErrMsg06        ;"NO END"
0008A0r 1  46 D9                        lsr     RUNFLAG           ;pos
0008A2r 1  4C rr rr     JmpERRMESS1:    jmp     ERRMESS
0008A5r 1               
0008A5r 1               ;
0008A5r 1               ; Token $5b RETURN
0008A5r 1               ;
0008A5r 1  A0 rr        RETURN:         ldy     #<ErrMsg09        ;"BAD RETURN"
0008A7r 1  A5 FC                        lda     GOSUBNDX
0008A9r 1  F0 F7                        beq     JmpERRMESS1
0008ABr 1  C6 FC                        dec     GOSUBNDX
0008ADr 1  A8                           tay
0008AEr 1  B9 1F 01                     lda     STK_20-1,y
0008B1r 1  85 DC                        sta     PR
0008B3r 1  B9 2F 01                     lda     STK_30-1,y
0008B6r 1  85 DD                        sta     PR+1
0008B8r 1  B6 FF                        ldx     STK_00-1,y
0008BAr 1  B9 0F 01                     lda     STK_10-1,y
0008BDr 1  A8           LE8BE:          tay
0008BEr 1  8A                           txa
0008BFr 1  4C rr rr                     jmp     GETNEXT
0008C2r 1               
0008C2r 1  A0 rr        STOPPED_AT:     ldy     #<ErrMsg12        ;"STOPPED AT"
0008C4r 1  20 rr rr                     jsr     ERRORMESS
0008C7r 1  A0 01                        ldy     #$01
0008C9r 1  B1 DC                        lda     (PR),y
0008CBr 1  AA                           tax
0008CCr 1  C8                           iny
0008CDr 1  B1 DC                        lda     (PR),y
0008CFr 1  20 rr rr                     jsr     PRDEC
0008D2r 1               ;
0008D2r 1               ; Token $51 END
0008D2r 1               ;
0008D2r 1  4C rr rr     END:            jmp     WARM
0008D5r 1               
0008D5r 1  C6 FB        LE8D6:          dec     FORNDX
0008D7r 1               ;
0008D7r 1               ; Token $59 NEXT
0008D7r 1               ;
0008D7r 1               ; Token $5a ,
0008D7r 1               ;   NEXT X,Y
0008D7r 1               ;
0008D7r 1  A0 rr        NEXT:           ldy     #<ErrMsg11        ;"BAD NEXT"
0008D9r 1  A5 FB                        lda     FORNDX
0008DBr 1  F0 C5        JmpERRMESS2:    beq     JmpERRMESS1       ;no more FORs
0008DDr 1  A8                           tay
0008DEr 1  B5 50                        lda     NOUNSTKL,x
0008E0r 1  D9 3F 01                     cmp     STK_40-1,y
0008E3r 1  D0 F0                        bne     LE8D6
0008E5r 1  B5 78                        lda     NOUNSTKH,x
0008E7r 1  D9 4F 01                     cmp     STK_50-1,y
0008EAr 1  D0 E9                        bne     LE8D6
0008ECr 1  B9 5F 01                     lda     STK_60-1,y
0008EFr 1  85 DA                        sta     AUX
0008F1r 1  B9 6F 01                     lda     STK_70-1,y
0008F4r 1  85 DB                        sta     AUX+1
0008F6r 1               ;
0008F6r 1  20 rr rr                     jsr     GET16BIT
0008F9r 1  CA                           dex
0008FAr 1  20 rr rr                     jsr     LE793
0008FDr 1  20 rr rr                     jsr     TE801
000900r 1  CA                           dex
000901r 1  A4 FB                        ldy     FORNDX
000903r 1  B9 CF 01                     lda     STK_D0-1,y
000906r 1  95 9F                        sta     NOUNSTKC-1,x
000908r 1  B9 BF 01                     lda     STK_C0-1,y
00090Br 1  A0 00                        ldy     #$00
00090Dr 1  20 rr rr                     jsr     LE708
000910r 1  20 rr rr                     jsr     SUBTRACT
000913r 1  20 rr rr                     jsr     SGN
000916r 1  20 rr rr                     jsr     GET16BIT
000919r 1  A4 FB                        ldy     FORNDX
00091Br 1  A5 CE                        lda     ACC
00091Dr 1  F0 05                        beq     LE925
00091Fr 1  59 6F 01                     eor     STK_70-1,y
000922r 1  10 12                        bpl     LE937
000924r 1               ;
000924r 1  B9 7F 01     LE925:          lda     STK_80-1,y
000927r 1  85 DC                        sta     PR
000929r 1  B9 8F 01                     lda     STK_90-1,y
00092Cr 1  85 DD                        sta     PR+1
00092Er 1               ;
00092Er 1  BE 9F 01                     ldx     STK_A0-1,y
000931r 1  B9 AF 01                     lda     STK_B0-1,y
000934r 1  D0 87                        bne     LE8BE
000936r 1  C6 FB        LE937:          dec     FORNDX
000938r 1  60                           rts
000939r 1               
000939r 1               ;
000939r 1               ; Token $55 FOR
000939r 1               ;
000939r 1  A0 rr        FOR:            ldy     #<ErrMsg10        ;"16 FORS"
00093Br 1  A5 FB                        lda     FORNDX
00093Dr 1  C9 10                        cmp     #16               ;sixteen FORs?
00093Fr 1  F0 9A                        beq     JmpERRMESS2       ;yes, error
000941r 1  E6 FB                        inc     FORNDX
000943r 1  A8                           tay
000944r 1  B5 50                        lda     NOUNSTKL,x
000946r 1  99 40 01                     sta     STK_40,y
000949r 1  B5 78                        lda     NOUNSTKH,x
00094Br 1  4C rr rr                     jmp     LF288
00094Er 1               
00094Er 1  60                           .byte    $60
00094Fr 1               
00094Fr 1               ;
00094Fr 1               ; Token $57 TO
00094Fr 1               ;
00094Fr 1  20 rr rr     TO:             jsr     GET16BIT
000952r 1  A4 FB                        ldy     FORNDX
000954r 1               ;
000954r 1  A5 CE                        lda     ACC
000956r 1  99 BF 01                     sta     STK_C0-1,y
000959r 1  A5 CF                        lda     ACC+1
00095Br 1  99 CF 01                     sta     STK_D0-1,y
00095Er 1               ;
00095Er 1  A9 01                        lda     #$01
000960r 1  99 5F 01                     sta     STK_60-1,y
000963r 1  A9 00                        lda     #$00
000965r 1  99 6F 01     LE966:           sta     STK_70-1,y
000968r 1               ;
000968r 1  A5 DC                        lda     PR
00096Ar 1  99 7F 01                     sta     STK_80-1,y
00096Dr 1  A5 DD                        lda     PR+1
00096Fr 1  99 8F 01                     sta     STK_90-1,y
000972r 1               ;
000972r 1  A5 E0                        lda     PX
000974r 1  99 9F 01                     sta     STK_A0-1,y
000977r 1  A5 E1                        lda     PX+1
000979r 1  99 AF 01                     sta     STK_B0-1,y
00097Cr 1  60                           rts
00097Dr 1               
00097Dr 1  20                           .byte    $20
00097Er 1  15                           .byte   $15
00097Fr 1               ;
00097Fr 1  00 00 00 AB  TABLE1:         .byte   $00,$00,$00,$ab,$03,$03,$03,$03
000983r 1  03 03 03 03  
000987r 1  03 03 03 03                  .byte   $03,$03,$03,$03,$03,$03,$03,$03
00098Br 1  03 03 03 03  
00098Fr 1  03 03 3F 3F                  .byte   $03,$03,$3f,$3f,$c0,$c0,$3c,$3c
000993r 1  C0 C0 3C 3C  
000997r 1  3C 3C 3C 3C                  .byte   $3c,$3c,$3c,$3c,$3c,$30,$0f,$c0
00099Br 1  3C 30 0F C0  
00099Fr 1  C3 FF 55 00                  .byte   $c3,$ff,$55,$00,$ab,$ab,$03,$03
0009A3r 1  AB AB 03 03  
0009A7r 1  FF FF 55 FF                  .byte   $ff,$ff,$55,$ff,$ff,$55,$cf,$cf
0009ABr 1  FF 55 CF CF  
0009AFr 1  CF CF CF FF                  .byte   $cf,$cf,$cf,$ff,$55,$c6,$c6,$c6
0009B3r 1  55 C6 C6 C6  
0009B7r 1  55 F0 F0 CF                  .byte   $55,$f0,$f0,$cf,$cf,$55,$01,$55
0009BBr 1  CF 55 01 55  
0009BFr 1  FF FF 55 03                  .byte   $ff,$ff,$55,$03,$03,$03,$03,$03
0009C3r 1  03 03 03 03  
0009C7r 1  03 03 03 03                  .byte   $03,$03,$03,$03,$03,$03,$03,$03
0009CBr 1  03 03 03 03  
0009CFr 1  03 03 03 03                  .byte   $03,$03,$03,$03,$03,$03,$03,$03
0009D3r 1  03 03 03 03  
0009D7r 1  03 03 03 03                  .byte   $03,$03,$03,$03,$03,$00,$ab,$03
0009DBr 1  03 00 AB 03  
0009DFr 1  57 03 03 03                  .byte   $57,$03,$03,$03,$03,$07,$03,$03
0009E3r 1  03 07 03 03  
0009E7r 1  03 03 03 03                  .byte   $03,$03,$03,$03,$03,$03,$03,$03
0009EBr 1  03 03 03 03  
0009EFr 1  03 03 AA FF                  .byte   $03,$03,$aa,$ff,$03,$03,$03,$03
0009F3r 1  03 03 03 03  
0009F7r 1  03 03 03 03                  .byte   $03,$03,$03,$03,$03,$03,$03,$03
0009FBr 1  03 03 03 03  
0009FFr 1               ;
0009FFr 1               ; Token address tables (verb dispatch tables).
0009FFr 1               ;
0009FFr 1  rr           VERBADRL:        .byte    <BEGIN_LINE
000A00r 1  FF                           .byte    $ff
000A01r 1  FF                           .byte    $ff
000A02r 1  rr                           .byte    <COLON
000A03r 1  rr                           .byte    <LOAD
000A04r 1  rr                           .byte    <SAVE
000A05r 1  rr                           .byte    <CON
000A06r 1  rr                           .byte    <RUNNUM
000A07r 1  rr                           .byte    <RUN
000A08r 1  rr                           .byte    <DEL
000A09r 1  rr                           .byte    <COMMA_DEL
000A0Ar 1  rr                           .byte    <NEW
000A0Br 1  rr                           .byte    <CLR
000A0Cr 1  rr                           .byte    <AUTO
000A0Dr 1  rr                           .byte    <COMMA_AUTO
000A0Er 1  rr                           .byte    <TEE54
000A0Fr 1  rr                           .byte    <VHIMEM
000A10r 1  rr                           .byte    <VLOMEM
000A11r 1  rr                           .byte    <TE785
000A12r 1  rr                           .byte    <SUBTRACT
000A13r 1  rr                           .byte    <MULT
000A14r 1  rr                           .byte    <DIVIDE
000A15r 1  rr                           .byte    <TE733
000A16r 1  rr                           .byte    <TE74A
000A17r 1  rr                           .byte    <TF25B
000A18r 1  rr                           .byte    <TF24E
000A19r 1  rr                           .byte    <TF253
000A1Ar 1  rr                           .byte    <TE74A
000A1Br 1  rr                           .byte    <TF249
000A1Cr 1  rr                           .byte    <VAND
000A1Dr 1  rr                           .byte    <VOR
000A1Er 1  rr                           .byte    <MOD
000A1Fr 1  rr                           .byte    <EXP
000A20r 1  FF                           .byte    $ff
000A21r 1  rr                           .byte    <TE823
000A22r 1  rr                           .byte    <COMMA_SUBSTR
000A23r 1  rr                           .byte    <GOTO
000A24r 1  rr                           .byte    <LET
000A25r 1  rr                           .byte    <TEFB6
000A26r 1  rr                           .byte    <TEBCB
000A27r 1  FF                           .byte    $ff
000A28r 1  FF                           .byte    $ff
000A29r 1  rr                           .byte    <PAREN_SUBSTR
000A2Ar 1  FF                           .byte    $ff
000A2Br 1  FF                           .byte    $ff
000A2Cr 1  rr                           .byte    <TEF24
000A2Dr 1  rr                           .byte    <PEEK
000A2Er 1  rr                           .byte    <RND
000A2Fr 1  rr                           .byte    <SGN
000A30r 1  rr                           .byte    <ABS
000A31r 1  rr                           .byte    <PDL
000A32r 1  FF                           .byte    $ff
000A33r 1  rr                           .byte    <TE823
000A34r 1  rr                           .byte    <POSITIVE
000A35r 1  rr                           .byte    <NEGATE
000A36r 1  rr                           .byte    <NOT
000A37r 1  rr                           .byte    <TE823
000A38r 1  rr                           .byte    <TE1D7
000A39r 1  rr                           .byte    <TE21C
000A3Ar 1  rr                           .byte    <LEN
000A3Br 1  rr                           .byte    <ASC
000A3Cr 1  rr                           .byte    <SCRN
000A3Dr 1  rr                           .byte    <COMMA_SCRN
000A3Er 1  rr                           .byte    <TE823
000A3Fr 1  FF                           .byte    $ff
000A40r 1  FF                           .byte    $ff
000A41r 1  rr                           .byte    <TE121
000A42r 1  rr                           .byte    <DIMSTR
000A43r 1  rr                           .byte    <DIMNUM
000A44r 1  rr                           .byte    <PRINTSTR
000A45r 1  rr                           .byte    <PRINTNUM
000A46r 1  rr                           .byte    <TE820
000A47r 1  rr                           .byte    <TEE00
000A48r 1  rr                           .byte    <TE7C1
000A49r 1  rr                           .byte    <TF3BA
000A4Ar 1  rr                           .byte    <MON_SETTXT
000A4Br 1  rr                           .byte    <MON_SETGR
000A4Cr 1  rr                           .byte    <CALL
000A4Dr 1  rr                           .byte    <DIMSTR
000A4Er 1  rr                           .byte    <DIMNUM
000A4Fr 1  rr                           .byte    <TAB
000A50r 1  rr                           .byte    <END
000A51r 1  rr                           .byte    <TEFB6
000A52r 1  rr                           .byte    <INPUT_PROMPT
000A53r 1  rr                           .byte    <TEBAA
000A54r 1  rr                           .byte    <FOR
000A55r 1  rr                           .byte    <TE801
000A56r 1  rr                           .byte    <TO
000A57r 1  rr                           .byte    <STEP
000A58r 1  rr                           .byte    <NEXT
000A59r 1  rr                           .byte    <NEXT
000A5Ar 1  rr                           .byte    <RETURN
000A5Br 1  rr                           .byte    <GOSUB
000A5Cr 1  FF                           .byte    $ff
000A5Dr 1  rr                           .byte    <LET
000A5Er 1  rr                           .byte    <GOTO
000A5Fr 1  rr                           .byte    <IF
000A60r 1  rr                           .byte    <PRINTSTR
000A61r 1  rr                           .byte    <PRINTNUM
000A62r 1  rr                           .byte    <PRINT_CR
000A63r 1  rr                           .byte    <POKE
000A64r 1  rr                           .byte    <GETVAL255
000A65r 1  rr                           .byte    <TEE4E
000A66r 1  rr                           .byte    <GETVAL255
000A67r 1  rr                           .byte    <COMMA_PLOT
000A68r 1  rr                           .byte    <GETVAL255
000A69r 1  rr                           .byte    <COMMA_HLIN
000A6Ar 1  rr                           .byte    <AT_HLIN
000A6Br 1  rr                           .byte    <GETVAL255
000A6Cr 1  rr                           .byte    <COMMA_VLIN
000A6Dr 1  rr                           .byte    <AT_VLIN
000A6Er 1  rr                           .byte    <IVTAB
000A6Fr 1  rr                           .byte    <TE18C
000A70r 1  rr                           .byte    <TE801
000A71r 1  rr                           .byte    <RIGHT_PAREN
000A72r 1  FF                           .byte    $ff
000A73r 1  rr                           .byte    <LISTNUM
000A74r 1  rr                           .byte    <COMMA_LIST
000A75r 1  rr                           .byte    <LIST
000A76r 1  rr                           .byte    <POP
000A77r 1  rr                           .byte    <NODSP_STR
000A78r 1  rr                           .byte    <NODSP_NUM
000A79r 1  rr                           .byte    <NOTRACE
000A7Ar 1  rr                           .byte    <DSP_STR
000A7Br 1  rr                           .byte    <DSP_NUM
000A7Cr 1  rr                           .byte    <TRACE
000A7Dr 1  rr                           .byte    <PRSLOT
000A7Er 1  rr                           .byte    <INSLOT
000A7Fr 1  rr           VERBADRH:       .byte    >BEGIN_LINE
000A80r 1  FF                           .byte    $ff
000A81r 1  FF                           .byte    $ff
000A82r 1  rr                           .byte    >COLON
000A83r 1  rr                           .byte    >LOAD
000A84r 1  rr                           .byte    >SAVE
000A85r 1  rr                           .byte    >CON
000A86r 1  rr                           .byte    >RUNNUM
000A87r 1  rr                           .byte    >RUN
000A88r 1  rr                           .byte    >DEL
000A89r 1  rr                           .byte    >COMMA_DEL
000A8Ar 1  rr                           .byte    >NEW
000A8Br 1  rr                           .byte    >CLR
000A8Cr 1  rr                           .byte    >AUTO
000A8Dr 1  rr                           .byte    >COMMA_AUTO
000A8Er 1  rr                           .byte    >TEE54
000A8Fr 1  rr                           .byte    >VHIMEM
000A90r 1  rr                           .byte    >VLOMEM
000A91r 1  rr                           .byte    >TE785
000A92r 1  rr                           .byte    >SUBTRACT
000A93r 1  rr                           .byte    >MULT
000A94r 1  rr                           .byte    >DIVIDE
000A95r 1  rr                           .byte    >TE733
000A96r 1  rr                           .byte    >TE74A
000A97r 1  rr                           .byte    >TF25B
000A98r 1  rr                           .byte    >TF24E
000A99r 1  rr                           .byte    >TF253
000A9Ar 1  rr                           .byte    >TE74A
000A9Br 1  rr                           .byte    >TF249
000A9Cr 1  rr                           .byte    >VAND
000A9Dr 1  rr                           .byte    >VOR
000A9Er 1  rr                           .byte    >MOD
000A9Fr 1  rr                           .byte    >EXP
000AA0r 1  FF                           .byte    $ff
000AA1r 1  rr                           .byte    >TE823
000AA2r 1  rr                           .byte    >COMMA_SUBSTR
000AA3r 1  rr                           .byte    >GOTO
000AA4r 1  rr                           .byte    >LET
000AA5r 1  rr                           .byte    >TEFB6
000AA6r 1  rr                           .byte    >TEBCB
000AA7r 1  FF                           .byte    $ff
000AA8r 1  FF                           .byte    $ff
000AA9r 1  rr                           .byte    >PAREN_SUBSTR
000AAAr 1  FF                           .byte    $ff
000AABr 1  FF                           .byte    $ff
000AACr 1  rr                           .byte    >TEF24
000AADr 1  rr                           .byte    >PEEK
000AAEr 1  rr                           .byte    >RND
000AAFr 1  rr                           .byte    >SGN
000AB0r 1  rr                           .byte    >ABS
000AB1r 1  rr                           .byte    >PDL
000AB2r 1  FF                           .byte    $ff
000AB3r 1  rr                           .byte    >TE823
000AB4r 1  rr                           .byte    >POSITIVE
000AB5r 1  rr                           .byte    >NEGATE
000AB6r 1  rr                           .byte    >NOT
000AB7r 1  rr                           .byte    >TE823
000AB8r 1  rr                           .byte    >TE1D7
000AB9r 1  rr                           .byte    >TE21C
000ABAr 1  rr                           .byte    >LEN
000ABBr 1  rr                           .byte    >ASC
000ABCr 1  rr                           .byte    >SCRN
000ABDr 1  rr                           .byte    >COMMA_SCRN
000ABEr 1  rr                           .byte    >TE823
000ABFr 1  FF                           .byte    $ff
000AC0r 1  FF                           .byte    $ff
000AC1r 1  rr                           .byte    >TE121
000AC2r 1  rr                           .byte    >DIMSTR
000AC3r 1  rr                           .byte    >DIMNUM
000AC4r 1  rr                           .byte    >PRINTSTR
000AC5r 1  rr                           .byte    >PRINTNUM
000AC6r 1  rr                           .byte    >TE820
000AC7r 1  rr                           .byte    >TEE00
000AC8r 1  rr                           .byte    >TE7C1
000AC9r 1  rr                           .byte    >TF3BA
000ACAr 1  rr                           .byte    >MON_SETTXT
000ACBr 1  rr                           .byte    >MON_SETGR
000ACCr 1  rr                           .byte    >CALL
000ACDr 1  rr                           .byte    >DIMSTR
000ACEr 1  rr                           .byte    >DIMNUM
000ACFr 1  rr                           .byte    >TAB
000AD0r 1  rr                           .byte    >END
000AD1r 1  rr                           .byte    >TEFB6
000AD2r 1  rr                           .byte    >INPUT_PROMPT
000AD3r 1  rr                           .byte    >TEBAA
000AD4r 1  rr                           .byte    >FOR
000AD5r 1  rr                           .byte    >TE801
000AD6r 1  rr                           .byte    >TO
000AD7r 1  rr                           .byte    >STEP
000AD8r 1  rr                           .byte    >NEXT
000AD9r 1  rr                           .byte    >NEXT
000ADAr 1  rr                           .byte    >RETURN
000ADBr 1  rr                           .byte    >GOSUB
000ADCr 1  FF                           .byte    $ff
000ADDr 1  rr                           .byte    >LET
000ADEr 1  rr                           .byte    >GOTO
000ADFr 1  rr                           .byte    >IF
000AE0r 1  rr                           .byte    >PRINTSTR
000AE1r 1  rr                           .byte    >PRINTNUM
000AE2r 1  rr                           .byte    >PRINT_CR
000AE3r 1  rr                           .byte    >POKE
000AE4r 1  rr                           .byte    >GETVAL255
000AE5r 1  rr                           .byte    >TEE4E
000AE6r 1  rr                           .byte    >GETVAL255
000AE7r 1  rr                           .byte    >COMMA_PLOT
000AE8r 1  rr                           .byte    >GETVAL255
000AE9r 1  rr                           .byte    >COMMA_HLIN
000AEAr 1  rr                           .byte    >AT_HLIN
000AEBr 1  rr                           .byte    >GETVAL255
000AECr 1  rr                           .byte    >COMMA_VLIN
000AEDr 1  rr                           .byte    >AT_VLIN
000AEEr 1  rr                           .byte    >IVTAB
000AEFr 1  rr                           .byte    >TE18C
000AF0r 1  rr                           .byte    >TE801
000AF1r 1  rr                           .byte    >RIGHT_PAREN
000AF2r 1  FF                           .byte    $ff
000AF3r 1  rr                           .byte    >LISTNUM
000AF4r 1  rr                           .byte    >COMMA_LIST
000AF5r 1  rr                           .byte    >LIST
000AF6r 1  rr                           .byte    >POP
000AF7r 1  rr                           .byte    >NODSP_STR
000AF8r 1  rr                           .byte    >NODSP_NUM
000AF9r 1  rr                           .byte    >NOTRACE
000AFAr 1  rr                           .byte    >DSP_STR
000AFBr 1  rr                           .byte    >DSP_NUM
000AFCr 1  rr                           .byte    >TRACE
000AFDr 1  rr                           .byte    >PRSLOT
000AFEr 1  rr                           .byte    >INSLOT
000AFFr 1               ;
000AFFr 1               ; Error messages.
000AFFr 1               ;
000AFFr 1  3E 33 32 37  ErrMsg00:        .byte   ">32767"
000B03r 1  36 37        
000B05r 1  54 4F 4F 20  ErrMsg01:        .byte   "TOO LONG"
000B09r 1  4C 4F 4E 47  
000B0Dr 1  53 59 4E 54  ErrMsg02:        .byte   "SYNTAX"
000B11r 1  41 58        
000B13r 1  4D 45 4D 20  ErrMsg03:        .byte   "MEM FULL"
000B17r 1  46 55 4C 4C  
000B1Br 1  54 4F 4F 20  ErrMsg04:        .byte   "TOO MANY PARENS"
000B1Fr 1  4D 41 4E 59  
000B23r 1  20 50 41 52  
000B2Ar 1  53 54 52 49  ErrMsg05:        .byte   "STRING"
000B2Er 1  4E 47        
000B30r 1  4E 4F 20 45  ErrMsg06:        .byte   "NO END"
000B34r 1  4E 44        
000B36r 1  42 41 44 20  ErrMsg07:        .byte   "BAD BRANCH"
000B3Ar 1  42 52 41 4E  
000B3Er 1  43 48        
000B40r 1  31 36 20 47  ErrMsg08:        .byte   "16 GOSUBS"
000B44r 1  4F 53 55 42  
000B48r 1  53           
000B49r 1  42 41 44 20  ErrMsg09:        .byte   "BAD RETURN"
000B4Dr 1  52 45 54 55  
000B51r 1  52 4E        
000B53r 1  31 36 20 46  ErrMsg10:        .byte   "16 FORS"
000B57r 1  4F 52 53     
000B5Ar 1  42 41 44 20  ErrMsg11:        .byte   "BAD NEXT"
000B5Er 1  4E 45 58 54  
000B62r 1  53 54 4F 50  ErrMsg12:        .byte   "STOPPED AT "
000B66r 1  50 45 44 20  
000B6Ar 1  41 54 20     
000B6Dr 1  2A 2A 2A 20  ErrMsg13:        .byte   "*** "
000B71r 1  20 45 52 52  ErrMsg14:        .byte   " ERR"
000B75r 1  8D                            .byte   $8d
000B76r 1  3E 32 35 35  ErrMsg15:        .byte   ">255"
000B7Ar 1  52 41 4E 47  ErrMsg16:        .byte   "RANGE"
000B7Er 1  45           
000B7Fr 1  44 49 4D     ErrMsg17:        .byte   "DIM"
000B82r 1  53 54 52 20  ErrMsg18:        .byte   "STR OVFL"
000B86r 1  4F 56 46 4C  
000B8Ar 1  5C 8D                         .byte   '\',$8d
000B8Cr 1  52 45 54 59  ErrMsg20:        .byte    "RETYPE LINE"
000B90r 1  50 45 20 4C  
000B94r 1  49 4E 45     
000B97r 1  8D                            .byte   $8d
000B98r 1  3F           ErrMsg21:        .byte   '?'
000B99r 1               
000B99r 1               ; Continue run w/o deleting vars?
000B99r 1  46 D9        LEB9A:          lsr     RUNFLAG           ;pos
000B9Br 1  90 03                        bcc     LEBA1
000B9Dr 1  4C rr rr                     jmp     STOPPED_AT
000BA0r 1               
000BA0r 1  A6 CF        LEBA1:          ldx     ACC+1
000BA2r 1  9A                           txs
000BA3r 1  A6 CE                        ldx     ACC
000BA5r 1  A0 rr                        ldy     #<ErrMsg20        ;"RETYPE LINE\r?"
000BA7r 1  D0 02                        bne     LEBAC             ;(always)
000BA9r 1               
000BA9r 1               ;
000BA9r 1               ; Token $54 INPUT
000BA9r 1               ;   num with no prompt
000BA9r 1               ;   INPUT X
000BA9r 1               ;
000BA9r 1  A0 rr        TEBAA:          ldy     #<ErrMsg21        ;"?" for INPUT
000BABr 1  20 rr rr     LEBAC:          jsr     ERRORMESS
000BAEr 1  86 CE                        stx     ACC
000BB0r 1  BA                           tsx
000BB1r 1  86 CF                        stx     ACC+1
000BB3r 1  20 rr rr                     jsr     LF366
000BB6r 1  84 F1                        sty     TOKNDX
000BB8r 1  A9 FF                        lda     #$ff
000BBAr 1  85 C8                        sta     TXTNDX
000BBCr 1  0A                           asl     A
000BBDr 1  85 D9                        sta     RUNFLAG           ;neg
000BBFr 1  A2 20                        ldx     #$20
000BC1r 1  A9 15                        lda     #$15
000BC3r 1  20 rr rr                     jsr     LE491
000BC6r 1  E6 D9                        inc     RUNFLAG
000BC8r 1  A6 CE                        ldx     ACC
000BCAr 1               ;
000BCAr 1               ; Token $27 ,
000BCAr 1               ;   num inputs
000BCAr 1               ;   INPUT "QUANTITY",Q
000BCAr 1               ;
000BCAr 1  A4 C8        TEBCB:           ldy     TXTNDX
000BCCr 1  0A                           asl     A
000BCDr 1  85 CE        LEBCE:           sta     ACC
000BCFr 1  C8                           iny
000BD0r 1  B9 00 02                     lda     IN,y
000BD3r 1  C9 80                        cmp     #$80
000BD5r 1  F0 D2                        beq     TEBAA             ;end of input?
000BD7r 1  49 30                        eor     #'0'
000BD9r 1  C9 0A                        cmp     #10
000BDBr 1  B0 F0                        bcs     LEBCE
000BDDr 1  C8                           iny
000BDEr 1  C8                           iny
000BDFr 1  84 C8                        sty     TXTNDX
000BE1r 1  B9 00 02                     lda     IN,y
000BE4r 1  48                           pha
000BE5r 1  B9 FF 01                     lda     IN-1,y
000BE8r 1  A0 00                        ldy     #$00
000BEAr 1  20 rr rr                     jsr     LE708
000BEDr 1  68                           pla
000BEEr 1  95 A0                        sta     NOUNSTKC,x
000BF0r 1  A5 CE                        lda     ACC
000BF2r 1  C9 33                        cmp     #$33
000BF4r 1  D0 03                        bne     LEBFA
000BF6r 1  20 rr rr                     jsr     NEGATE
000BF9r 1  4C rr rr     LEBFA:           jmp     TE801
000BFCr 1               
000BFCr 1  FF FF FF FF                  .byte  $ff,$ff,$ff,$ff      ; adjust 4 bytes to align to page boundary?
000C00r 1               ;
000C00r 1               ; Token / syntax table.
000C00r 1               ;
000C00r 1               ; Each entry has a token, stored in reverse, with character values adjusted.
000C00r 1               ; For example, "TRACE" is stored:
000C00r 1               ;   "E"+32, "C"-32, "A"-32, "R"-32", "T"-32
000C00r 1               ;   $e5     $a3     $a1     $b2      $b4
000C00r 1               ;
000C00r 1  50 20 4F C0  SYNTABL:        .byte   $50,$20,$4f,$c0,$f4,$a1,$e4,$af
000C04r 1  F4 A1 E4 AF  
000C08r 1  AD F2 AF E4                  .byte   $ad,$f2,$af,$e4,$ae,$a1,$f0,$a5
000C0Cr 1  AE A1 F0 A5  
000C10r 1  B4 B3 EF B4                  .byte   $b4,$b3,$ef,$b4,$ee,$a5,$a8,$b4
000C14r 1  EE A5 A8 B4  
000C18r 1               ;
000C18r 1  5C 80 00 40                  .byte   $5c,$80,$00,$40,$60,$8d,$60,$8b
000C1Cr 1  60 8D 60 8B  
000C20r 1  7F 1D 20 7E                  .byte   $7f,$1d,$20,$7e,$8c,$33,$00,$00
000C24r 1  8C 33 00 00  
000C28r 1  60 03 BF 12                  .byte   $60,$03,$bf,$12
000C2Cr 1               ;
000C2Cr 1  47 83 AE A9                  .byte   $47,$83,$ae,$a9,$67,$83,$b2,$b0
000C30r 1  67 83 B2 B0  
000C34r 1  E5 A3 A1 B2                  .byte   $e5,$a3,$a1,$b2,$b4,$79,$b0,$b3
000C38r 1  B4 79 B0 B3  
000C3Cr 1  A4 69 B0 B3                  .byte   $a4,$69,$b0,$b3,$a4,$e5,$a3,$a1
000C40r 1  A4 E5 A3 A1  
000C44r 1  B2 B4 AF AE                  .byte   $b2,$b4,$af,$ae,$79,$b0,$b3,$a4
000C48r 1  79 B0 B3 A4  
000C4Cr 1  AF AE 69 B0                  .byte   $af,$ae,$69,$b0,$b3,$a4,$af,$ae
000C50r 1  B3 A4 AF AE  
000C54r 1  F0 AF B0 F4                  .byte   $f0,$af,$b0,$f4,$b3,$a9,$ac,$60
000C58r 1  B3 A9 AC 60  
000C5Cr 1  8C 20 B4 B3                  .byte   $8c,$20,$b4,$b3,$a9,$ac
000C60r 1  A9 AC        
000C62r 1  00                           .byte    $00
000C63r 1  40 89 C9 47                  .byte   $40,$89,$c9,$47,$9d,$17,$68,$9d
000C67r 1  9D 17 68 9D  
000C6Br 1  0A 58 7B 67                  .byte   $0a,$58,$7b,$67,$a2,$a1,$b4,$b6
000C6Fr 1  A2 A1 B4 B6  
000C73r 1  67 B4 A1 07                  .byte   $67,$b4,$a1,$07,$8c,$07,$ae,$a9
000C77r 1  8C 07 AE A9  
000C7Br 1  AC B6 67 B4                  .byte   $ac,$b6,$67,$b4,$a1,$07,$8c,$07
000C7Fr 1  A1 07 8C 07  
000C83r 1  AE A9 AC A8                  .byte   $ae,$a9,$ac,$a8,$67,$8c,$07,$b4
000C87r 1  67 8C 07 B4  
000C8Br 1  AF AC B0 67                  .byte   $af,$ac,$b0,$67,$9d,$b2,$af,$ac
000C8Fr 1  9D B2 AF AC  
000C93r 1  AF A3 67 8C                  .byte   $af,$a3,$67,$8c,$07,$a5,$ab,$af
000C97r 1  07 A5 AB AF  
000C9Br 1  B0 F4 AE A9                  .byte   $b0,$f4,$ae,$a9,$b2,$b0,$7f,$0e
000C9Fr 1  B2 B0 7F 0E  
000CA3r 1  27 B4 AE A9                  .byte   $27,$b4,$ae,$a9,$b2,$b0,$7f,$0e
000CA7r 1  B2 B0 7F 0E  
000CABr 1  28 B4 AE A9                  .byte   $28,$b4,$ae,$a9,$b2,$b0,$64,$07
000CAFr 1  B2 B0 64 07  
000CB3r 1  A6 A9 67 AF                  .byte   $a6,$a9,$67,$af,$b4,$af,$a7,$78
000CB7r 1  B4 AF A7 78  
000CBBr 1  B4 A5 AC 6B                  .byte   $b4,$a5,$ac,$6b,$7f,$02,$ad,$a5
000CBFr 1  7F 02 AD A5  
000CC3r 1  B2 67 A2 B5                  .byte   $b2,$67,$a2,$b5,$b3,$af,$a7,$ee
000CC7r 1  B3 AF A7 EE  
000CCBr 1  B2 B5 B4 A5                  .byte   $b2,$b5,$b4,$a5,$b2,$7e,$8c,$39
000CCFr 1  B2 7E 8C 39  
000CD3r 1  B4 B8 A5 AE                  .byte   $b4,$b8,$a5,$ae,$67,$b0,$a5,$b4
000CD7r 1  67 B0 A5 B4  
000CDBr 1  B3 27 AF B4                  .byte   $b3,$27,$af,$b4,$07,$9d,$19,$b2
000CDFr 1  07 9D 19 B2  
000CE3r 1  AF A6 7F 05                  .byte   $af,$a6,$7f,$05,$37,$b4,$b5,$b0
000CE7r 1  37 B4 B5 B0  
000CEBr 1  AE A9 7F 05                  .byte   $ae,$a9,$7f,$05,$28,$b4,$b5,$b0
000CEFr 1  28 B4 B5 B0  
000CF3r 1  AE A9 7F 05                  .byte   $ae,$a9,$7f,$05,$2a,$b4,$b5,$b0
000CF7r 1  2A B4 B5 B0  
000CFBr 1  AE A9 E4 AE                  .byte   $ae,$a9,$e4,$ae,$a5
000CFFr 1  A5           
000D00r 1               ;
000D00r 1  00           SYNTABL2:       .byte    $00
000D01r 1  47 A2 A1 B4                  .byte   $47,$a2,$a1,$b4,$7f,$0d,$30,$ad
000D05r 1  7F 0D 30 AD  
000D09r 1  A9 A4 7F 0D                  .byte   $a9,$a4,$7f,$0d,$23,$ad,$a9,$a4
000D0Dr 1  23 AD A9 A4  
000D11r 1  67 AC AC A1                  .byte   $67,$ac,$ac,$a1,$a3,$f2,$a7,$f4
000D15r 1  A3 F2 A7 F4  
000D19r 1  B8 A5 B4                     .byte   $b8,$a5,$b4
000D1Cr 1  00                           .byte    $00                              ;above are statements
000D1Dr 1  4D CC 67 8C                  .byte   $4d,$cc,$67,$8c,$68,$8c,$db,$67
000D21r 1  68 8C DB 67  
000D25r 1  9B 68 9B 50                  .byte   $9b,$68,$9b,$50,$8c,$63,$8c,$7f
000D29r 1  8C 63 8C 7F  
000D2Dr 1  01 51 07 88                  .byte   $01,$51,$07,$88,$29,$84,$80,$c4
000D31r 1  29 84 80 C4  
000D35r 1  19 57 71 07                  .byte   $19,$57,$71,$07,$88,$14,$71,$07
000D39r 1  88 14 71 07  
000D3Dr 1  8C 07 88 AE                  .byte   $8c,$07,$88,$ae,$b2,$a3,$b3,$71
000D41r 1  B2 A3 B3 71  
000D45r 1  08 88 A3 B3                  .byte   $08,$88,$a3,$b3,$a1,$71,$08,$88
000D49r 1  A1 71 08 88  
000D4Dr 1  AE A5 AC 68                  .byte   $ae,$a5,$ac,$68,$83,$08,$68,$9d
000D51r 1  83 08 68 9D  
000D55r 1  08 71 07 88                  .byte   $08,$71,$07,$88,$60,$75,$b4,$af
000D59r 1  60 75 B4 AF  
000D5Dr 1  AE 75 8D 75                  .byte   $ae,$75,$8d,$75,$8b,$51,$07,$88
000D61r 1  8B 51 07 88  
000D65r 1  19 B8 A4 AE                  .byte   $19,$b8,$a4,$ae,$b2,$ec,$a4,$b0
000D69r 1  B2 EC A4 B0  
000D6Dr 1  F3 A2 A1 EE                  .byte   $f3,$a2,$a1,$ee,$a7,$b3,$e4,$ae
000D71r 1  A7 B3 E4 AE  
000D75r 1  B2 EB A5 A5                  .byte   $b2,$eb,$a5,$a5,$b0,$51,$07,$88
000D79r 1  B0 51 07 88  
000D7Dr 1  39 81 C1 4F                  .byte   $39,$81,$c1,$4f,$7f,$0f,$2f,$00
000D81r 1  7F 0F 2F 00  
000D85r 1  51 06 88 29                  .byte   $51,$06,$88,$29,$c2,$0c,$82,$57
000D89r 1  C2 0C 82 57  
000D8Dr 1  8C 6A 8C 42                  .byte   $8c,$6a,$8c,$42,$ae,$a5,$a8,$b4
000D91r 1  AE A5 A8 B4  
000D95r 1  60 AE A5 A8                  .byte   $60,$ae,$a5,$a8,$b4,$4f,$7e,$1e
000D99r 1  B4 4F 7E 1E  
000D9Dr 1  35 8C 27 51                  .byte   $35,$8c,$27,$51,$07,$88,$09,$8b
000DA1r 1  07 88 09 8B  
000DA5r 1  FE E4 AF AD                  .byte   $fe,$e4,$af,$ad,$f2,$af,$e4,$ae
000DA9r 1  F2 AF E4 AE  
000DADr 1  A1 DC DE 9C                  .byte   $a1,$dc,$de,$9c,$dd,$9c,$de,$dd
000DB1r 1  DD 9C DE DD  
000DB5r 1  9E C3 DD CF                  .byte   $9e,$c3,$dd,$cf,$ca,$cd,$cb
000DB9r 1  CA CD CB     
000DBCr 1  00                           .byte    $00                              ;above 4 are num ops
000DBDr 1  47 9A AD A5                  .byte   $47,$9a,$ad,$a5,$ad,$af,$ac,$67
000DC1r 1  AD AF AC 67  
000DC5r 1  9A AD A5 AD                  .byte   $9a,$ad,$a5,$ad,$a9,$a8,$ee,$a1
000DC9r 1  A9 A8 EE A1  
000DCDr 1  AD 60 8C 20                  .byte   $ad,$60,$8c,$20,$af,$b4,$b5,$a1
000DD1r 1  AF B4 B5 A1  
000DD5r 1  F2 AC A3 F7                  .byte   $f2,$ac,$a3,$f7,$a5,$ae,$60,$8c
000DD9r 1  A5 AE 60 8C  
000DDDr 1  20 AC A5 A4                  .byte   $20,$ac,$a5,$a4,$ee,$b5,$b2,$60
000DE1r 1  EE B5 B2 60  
000DE5r 1  AE B5 B2 EE                  .byte   $ae,$b5,$b2,$ee,$af,$a3,$e5,$b6
000DE9r 1  AF A3 E5 B6  
000DEDr 1  A1 B3 E4 A1                  .byte   $a1,$b3,$e4,$a1,$af,$ac
000DF1r 1  AF AC        
000DF3r 1                                                                         ; Above are commands.
000DF3r 1  7A 7E 9A 22                  .byte   $7a,$7e,$9a,$22,$20,$00,$60,$03
000DF7r 1  20 00 60 03  
000DFBr 1  BF 60 03 BF                  .byte   $bf,$60,$03,$bf,$1f
000DFFr 1  1F           
000E00r 1               
000E00r 1               ;
000E00r 1               ; Token $48 ,
000E00r 1               ;   string prints
000E00r 1               ;   PRINT T,A$
000E00r 1               ;
000E00r 1  20 rr rr     TEE00:          jsr     LE7B1
000E03r 1               ;
000E03r 1               ; Token $45 ;
000E03r 1               ;   string prints
000E03r 1               ;   PRINT anytype ; string
000E03r 1               ;
000E03r 1               ; Token $61 PRINT
000E03r 1               ;   string var or literal
000E03r 1               ;   PRINT A$: PRINT "HELLO"
000E03r 1               ;
000E03r 1  E8           PRINTSTR:       inx
000E04r 1  E8                           inx
000E05r 1  B5 4F                        lda     NOUNSTKL-1,x
000E07r 1  85 DA                        sta     AUX
000E09r 1  B5 77                        lda     NOUNSTKH-1,x
000E0Br 1  85 DB                        sta     AUX+1
000E0Dr 1  B4 4E                        ldy     NOUNSTKL-2,x
000E0Fr 1  98           Loop40:         tya
000E10r 1  D5 76                        cmp     NOUNSTKH-2,x
000E12r 1  B0 09                        bcs     LEE1D             ;exit loop
000E14r 1  B1 DA                        lda     (AUX),y
000E16r 1  20 rr rr                     jsr     MON_COUT
000E19r 1  C8                           iny
000E1Ar 1  4C rr rr                     jmp     Loop40
000E1Dr 1               
000E1Dr 1  A9 FF        LEE1D:          lda     #$ff
000E1Fr 1  85 D5                        sta     CRFLAG            ;CRFLAG = $ff
000E21r 1  60                           rts
000E22r 1               
000E22r 1               ;
000E22r 1               ; Token $3b LEN(
000E22r 1               ;
000E22r 1  E8           LEN:            inx
000E23r 1  A9 00                        lda     #$00
000E25r 1  95 78                        sta     NOUNSTKH,x
000E27r 1  95 A0                        sta     NOUNSTKC,x
000E29r 1  B5 77                        lda     NOUNSTKH-1,x
000E2Br 1  38                           sec
000E2Cr 1  F5 4F                        sbc     NOUNSTKL-1,x
000E2Er 1  95 50                        sta     NOUNSTKL,x
000E30r 1  4C rr rr                     jmp     TE823
000E33r 1               
000E33r 1  FF                           .byte    $ff
000E34r 1               
000E34r 1  20 rr rr     GETBYTE:        jsr     GET16BIT
000E37r 1  A5 CF                        lda     ACC+1
000E39r 1  D0 28                        bne     HI255ERR          ;">255"
000E3Br 1  A5 CE                        lda     ACC
000E3Dr 1  60                           rts
000E3Er 1               
000E3Er 1               ;
000E3Er 1               ; Token $68 ,
000E3Er 1               ;   PLOT 20,15
000E3Er 1               ;
000E3Er 1  20 rr rr     COMMA_PLOT:     jsr     GETBYTE
000E41r 1  A4 C8                        ldy     TXTNDX
000E43r 1  C9 30                        cmp     #48
000E45r 1  B0 21                        bcs     RANGERR
000E47r 1  C0 28                        cpy     #40
000E49r 1  B0 1D                        bcs     RANGERR
000E4Br 1  4C rr rr                     jmp     MON_PLOT
000E4Er 1               
000E4Er 1               ;
000E4Er 1               ; Token $66 COLOR=
000E4Er 1               ;
000E4Er 1  20 rr rr     TEE4E:          jsr     GETBYTE
000E51r 1  4C rr rr                     jmp     MON_SETCOL
000E54r 1               
000E54r 1               ;
000E54r 1               ; Token $0f MAN
000E54r 1               ;
000E54r 1  46 F8        TEE54:          lsr     AUTOFLAG          ;manual
000E56r 1  60                           rts
000E57r 1               
000E57r 1               ;
000E57r 1               ; Token $6f VTAB
000E57r 1               ;
000E57r 1  20 rr rr     IVTAB:          jsr     LF3B3
000E5Ar 1  C9 18                        cmp     #24
000E5Cr 1  B0 0A                        bcs     RANGERR
000E5Er 1  85 25                        sta     MON_CV
000E60r 1  4C rr rr                     jmp     MON_VTAB
000E63r 1               
000E63r 1  A0 rr        HI255ERR:       ldy     #<ErrMsg15        ;">255"
000E65r 1  4C rr rr     JmpERRMESS3:    jmp     ERRMESS
000E68r 1               
000E68r 1  A0 rr        RANGERR:        ldy     #<ErrMsg16        ;"RANGE"
000E6Ar 1  D0 F9                        bne     JmpERRMESS3
000E6Cr 1               
000E6Cr 1               ;
000E6Cr 1               ; Divide routine.
000E6Cr 1               ;
000E6Cr 1  20 rr rr     LEE6C:          jsr     LE254
000E6Fr 1  A5 DA                        lda     AUX               ;is AUX zero?
000E71r 1  D0 07                        bne     LEE7A
000E73r 1  A5 DB                        lda     AUX+1
000E75r 1  D0 03                        bne     LEE7A
000E77r 1  4C rr rr                     jmp     Err32767          ;yes, ">32767" error
000E7Ar 1               
000E7Ar 1  06 CE        LEE7A:          asl     ACC
000E7Cr 1  26 CF                        rol     ACC+1
000E7Er 1  26 E6                        rol     P3
000E80r 1  26 E7                        rol     P3+1
000E82r 1  A5 E6                        lda     P3
000E84r 1  C5 DA                        cmp     AUX               ;compare P3 to AUX
000E86r 1  A5 E7                        lda     P3+1
000E88r 1  E5 DB                        sbc     AUX+1
000E8Ar 1  90 0A                        bcc     LEE96
000E8Cr 1  85 E7                        sta     P3+1              ;P3 = P3 - AUX
000E8Er 1  A5 E6                        lda     P3
000E90r 1  E5 DA                        sbc     AUX
000E92r 1  85 E6                        sta     P3
000E94r 1  E6 CE                        inc     ACC
000E96r 1  88           LEE96:          dey
000E97r 1  D0 E1                        bne     LEE7A
000E99r 1  60                           rts
000E9Ar 1               
000E9Ar 1  FF FF FF FF                  .byte   $ff,$ff,$ff,$ff,$ff,$ff
000E9Er 1  FF FF        
000EA0r 1               
000EA0r 1               ;
000EA0r 1               ; Token $4d CALL
000EA0r 1               ;
000EA0r 1  20 rr rr     CALL:           jsr     GET16BIT
000EA3r 1  6C CE 00                     jmp     (ACC)
000EA6r 1               
000EA6r 1               ;
000EA6r 1               ; Token $6a ,
000EA6r 1               ;   HLIN 10,20 AT 30
000EA6r 1               ;
000EA6r 1  20 rr rr     COMMA_HLIN:     jsr     GETBYTE
000EA9r 1  C5 C8                        cmp     TXTNDX
000EABr 1  90 BB                        bcc     RANGERR
000EADr 1  85 2C                        sta     MON_H2
000EAFr 1  60                           rts
000EB0r 1               
000EB0r 1               ;
000EB0r 1               ; Token $6b AT
000EB0r 1               ;   HLIN 10,20 AT 30
000EB0r 1               ;
000EB0r 1  20 rr rr     AT_HLIN:        jsr     GETBYTE
000EB3r 1  C9 30                        cmp     #48
000EB5r 1  B0 B1                        bcs     RANGERR
000EB7r 1  A4 C8                        ldy     TXTNDX
000EB9r 1  4C rr rr                     jmp     MON_HLINE
000EBCr 1               
000EBCr 1               ;
000EBCr 1               ; Token $6d ,
000EBCr 1               ;   VLIN 10,20 AT 30
000EBCr 1               ;
000EBCr 1  20 rr rr     COMMA_VLIN:     jsr     GETBYTE
000EBFr 1  C5 C8                        cmp     TXTNDX
000EC1r 1  90 A5                        bcc     RANGERR
000EC3r 1  85 2D                        sta     MON_V2
000EC5r 1  60                           rts
000EC6r 1               
000EC6r 1               ;
000EC6r 1               ; Token $6e AT
000EC6r 1               ;   VLIN 10,20 AT 30
000EC6r 1               ;
000EC6r 1  20 rr rr     AT_VLIN:        jsr     GETBYTE
000EC9r 1  C9 28                        cmp     #40
000ECBr 1  B0 9B        BcsRANGERR:     bcs     RANGERR
000ECDr 1  A8                           tay
000ECEr 1  A5 C8                        lda     TXTNDX
000ED0r 1  4C rr rr                     jmp     MON_VLINE
000ED3r 1               
000ED3r 1  98           PRINTERR:       tya
000ED4r 1  AA                           tax
000ED5r 1  A0 rr                        ldy     #<ErrMsg13        ;"*** "
000ED7r 1  20 rr rr                     jsr     ERRORMESS
000EDAr 1  8A                           txa
000EDBr 1  A8                           tay
000EDCr 1  20 rr rr                     jsr     ERRORMESS
000EDFr 1  A0 rr                        ldy     #<ErrMsg14        ;" ERR"
000EE1r 1  4C rr rr                     jmp     PRTERR
000EE4r 1               
000EE4r 1  20 rr rr     LEEE4:          jsr     LF23F
000EE7r 1  06 CE        LEEE7:          asl     ACC
000EE9r 1  26 CF                        rol     ACC+1
000EEBr 1  30 FA                        bmi     LEEE7
000EEDr 1  B0 DC                        bcs     BcsRANGERR
000EEFr 1  D0 04                        bne     LEEF5
000EF1r 1  C5 CE                        cmp     ACC
000EF3r 1  B0 D6                        bcs     BcsRANGERR
000EF5r 1  60           LEEF5:          rts
000EF6r 1               
000EF6r 1               ;
000EF6r 1               ; Token $2e PEEK
000EF6r 1               ;   uses tken $3f (
000EF6r 1               ;
000EF6r 1  20 rr rr     PEEK:           jsr     GET16BIT
000EF9r 1  B1 CE                        lda     (ACC),y
000EFBr 1  94 9F                        sty     NOUNSTKC-1,x
000EFDr 1  4C rr rr                     jmp     LE708
000F00r 1               
000F00r 1               ;
000F00r 1               ; Token $65 ,
000F00r 1               ;   POKE 20000,5
000F00r 1               ;
000F00r 1               ; Token $67 PLOT
000F00r 1               ;
000F00r 1               ; Token $69 HLIN
000F00r 1               ;
000F00r 1               ; Token $6c VLIN
000F00r 1               ;
000F00r 1  20 rr rr     GETVAL255:      jsr     GETBYTE
000F03r 1  A5 CE                        lda     ACC
000F05r 1  85 C8                        sta     TXTNDX
000F07r 1  60                           rts
000F08r 1               
000F08r 1               ;
000F08r 1               ; Token $64 POKE
000F08r 1               ;
000F08r 1  20 rr rr     POKE:           jsr     GET16BIT
000F0Br 1  A5 C8                        lda     TXTNDX
000F0Dr 1  91 CE                        sta     (ACC),y
000F0Fr 1  60                           rts
000F10r 1               
000F10r 1               ;
000F10r 1               ; Token $15 /
000F10r 1               ;   num op. uses $38 (
000F10r 1               ;   A = 27 / 2
000F10r 1               ;
000F10r 1  20 rr rr     DIVIDE:         jsr     LEE6C
000F13r 1  A5 CE                        lda     ACC               ;P3 = ACC
000F15r 1  85 E6                        sta     P3
000F17r 1  A5 CF                        lda     ACC+1
000F19r 1  85 E7                        sta     P3+1
000F1Br 1  4C rr rr                     jmp     MultEnd
000F1Er 1               
000F1Er 1               ;
000F1Er 1               ; Token $44 ,
000F1Er 1               ;   next var in DIM is num
000F1Er 1               ;   DIM X(5),A(5)
000F1Er 1               ;
000F1Er 1               ; Token $4f DIM
000F1Er 1               ;   num var. uses tkn $22 (
000F1Er 1               ;   DIM A(5)
000F1Er 1               ;
000F1Er 1  20 rr rr     DIMNUM:         jsr     LEEE4
000F21r 1  4C rr rr                     jmp     LE134
000F24r 1               
000F24r 1               ;
000F24r 1               ; Token $2d (
000F24r 1               ;   var array
000F24r 1               ;   X(12)
000F24r 1               ;
000F24r 1  20 rr rr     TEF24:          jsr     LEEE4
000F27r 1  B4 78                        ldy     NOUNSTKH,x
000F29r 1  B5 50                        lda     NOUNSTKL,x
000F2Br 1  69 FE                        adc     #$fe
000F2Dr 1  B0 01                        bcs     LEF30
000F2Fr 1  88                           dey
000F30r 1  85 DA        LEF30:          sta     AUX
000F32r 1  84 DB                        sty     AUX+1
000F34r 1  18                           clc
000F35r 1  65 CE                        adc     ACC
000F37r 1  95 50                        sta     NOUNSTKL,x
000F39r 1  98                           tya
000F3Ar 1  65 CF                        adc     ACC+1
000F3Cr 1  95 78                        sta     NOUNSTKH,x
000F3Er 1  A0 00                        ldy     #$00
000F40r 1  B5 50                        lda     NOUNSTKL,x
000F42r 1  D1 DA                        cmp     (AUX),y
000F44r 1  C8                           iny
000F45r 1  B5 78                        lda     NOUNSTKH,x
000F47r 1  F1 DA                        sbc     (AUX),y
000F49r 1  B0 80                        bcs     BcsRANGERR        ;"RANGE"
000F4Br 1  4C rr rr                     jmp     TE823
000F4Er 1               
000F4Er 1               ;
000F4Er 1               ; Token $2f RND
000F4Er 1               ;   uses tken $3f (
000F4Er 1               ;
000F4Er 1  20 rr rr     RND:            jsr     GET16BIT
000F51r 1  A5 4E                        lda     MON_RNDL
000F53r 1  20 rr rr                     jsr     LE708
000F56r 1  A5 4F                        lda     MON_RNDH
000F58r 1  D0 04                        bne     LEF5E
000F5Ar 1  C5 4E                        cmp     MON_RNDL
000F5Cr 1  69 00                        adc     #$00
000F5Er 1  29 7F        LEF5E:          and     #$7f
000F60r 1  85 4F                        sta     MON_RNDH
000F62r 1  95 A0                        sta     NOUNSTKC,x
000F64r 1  A0 11                        ldy     #$11
000F66r 1  A5 4F        LEF66:          lda     MON_RNDH
000F68r 1  0A                           asl     A
000F69r 1  18                           clc
000F6Ar 1  69 40                        adc     #$40
000F6Cr 1  0A                           asl     A
000F6Dr 1  26 4E                        rol     MON_RNDL
000F6Fr 1  26 4F                        rol     MON_RNDH
000F71r 1  88                           dey
000F72r 1  D0 F2                        bne     LEF66
000F74r 1  A5 CE                        lda     ACC
000F76r 1  20 rr rr                     jsr     LE708
000F79r 1  A5 CF                        lda     ACC+1
000F7Br 1  95 A0                        sta     NOUNSTKC,x
000F7Dr 1  4C rr rr                     jmp     MOD
000F80r 1               
000F80r 1  20 rr rr     unref_ef80:     jsr     GET16BIT
000F83r 1  A4 CE                        ldy     ACC               ;compare ACC and LOMEM
000F85r 1  C4 4A                        cpy     LOMEM
000F87r 1  A5 CF                        lda     ACC+1
000F89r 1  E5 4B                        sbc     LOMEM+1
000F8Br 1  90 1E                        bcc     JmpBcsRANGEERR    ;[bad idea]
000F8Dr 1  84 4C                        sty     HIMEM             ;HIMEM = ACC
000F8Fr 1  A5 CF                        lda     ACC+1
000F91r 1  85 4D                        sta     HIMEM+1
000F93r 1  4C rr rr     unref_branch:   jmp     NEW
000F96r 1               
000F96r 1  20 rr rr     unref_ef96:     jsr     GET16BIT
000F99r 1  A4 CE                        ldy     ACC               ;compare ACC and LOMEM
000F9Br 1  C4 4C                        cpy     HIMEM
000F9Dr 1  A5 CF                        lda     ACC+1
000F9Fr 1  E5 4D                        sbc     HIMEM+1
000FA1r 1  B0 08                        bcs     JmpBcsRANGEERR
000FA3r 1  84 4A                        sty     LOMEM             ;LOMEM = ACC
000FA5r 1  A5 CF                        lda     ACC+1
000FA7r 1  85 4B                        sta     LOMEM+1
000FA9r 1  90 E8                        bcc     unref_branch     ;(always)
000FABr 1               
000FABr 1  4C rr rr     JmpBcsRANGEERR: jmp     BcsRANGERR
000FAEr 1               
000FAEr 1  FF FF FF FF                  .byte   $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
000FB2r 1  FF FF FF FF  
000FB6r 1               
000FB6r 1               ;
000FB6r 1               ; Token $26 ,
000FB6r 1               ;   string inputs
000FB6r 1               ;   INPUT "WHO",W$
000FB6r 1               ;
000FB6r 1               ; Token $52 INPUT
000FB6r 1               ;   string with no prompt
000FB6r 1               ;   INPUT S$
000FB6r 1               ;
000FB6r 1  20 rr rr     TEFB6:          jsr     INPUTSTR
000FB9r 1  4C rr rr                     jmp     LEFBF
000FBCr 1               
000FBCr 1               ;
000FBCr 1               ; Token $53 INPUT
000FBCr 1               ;   string or num with prompt
000FBCr 1               ;   INPUT "WHO",W$: INPUT "QUANTITY",Q
000FBCr 1               ;
000FBCr 1  20 rr rr     INPUT_PROMPT:   jsr     PRINTSTR
000FBFr 1  A9 FF        LEFBF:          lda     #$ff
000FC1r 1  85 C8                        sta     TXTNDX
000FC3r 1  A9 80                        lda     #$80
000FC5r 1  8D 00 02                     sta     IN
000FC8r 1  60                           rts
000FC9r 1               
000FC9r 1  20 rr rr     LEFC9:          jsr     NOT
000FCCr 1  E8                           inx
000FCDr 1  20 rr rr     LEFCD:          jsr     NOT
000FD0r 1  B5 50                        lda     NOUNSTKL,x
000FD2r 1  60                           rts
000FD3r 1               
000FD3r 1               ; Old 4K cold start.
000FD3r 1  A9 00        LEFD3:          lda     #$00
000FD5r 1  85 4A                        sta     LOMEM             ;LOMEM = $0800
000FD7r 1  85 4C                        sta     HIMEM             ;HIMEM = $1000
000FD9r 1  A9 08                        lda     #$08
000FDBr 1  85 4B                        sta     LOMEM+1
000FDDr 1  A9 10                        lda     #$10
000FDFr 1  85 4D                        sta     HIMEM+1
000FE1r 1  4C rr rr                     jmp     NEW
000FE4r 1               
000FE4r 1  D5 78        LEFE4:          cmp     NOUNSTKH,x
000FE6r 1  D0 01                        bne     LEFE9
000FE8r 1  18                           clc
000FE9r 1  4C rr rr     LEFE9:          jmp     LE102
000FECr 1               
000FECr 1               ;
000FECr 1               ; Token $08 RUN
000FECr 1               ;   run from first line of program
000FECr 1               ;
000FECr 1  20 rr rr     RUN:            jsr     CLR
000FEFr 1  4C rr rr                     jmp     RUNWARM
000FF2r 1               
000FF2r 1               ;
000FF2r 1               ; Token $07 RUN
000FF2r 1               ;   RUN 100
000FF2r 1               ;
000FF2r 1  20 rr rr     RUNNUM:         jsr     CLR
000FF5r 1  4C rr rr                     jmp     GOTO
000FF8r 1               
000FF8r 1  E0 80        LEFF8:          cpx     #$80
000FFAr 1  D0 01                        bne     LEFFD
000FFCr 1  88                           dey
000FFDr 1  4C rr rr     LEFFD:          jmp     LE00C
001000r 1               
001000r 1               ;
001000r 1               ; Cold start.
001000r 1               ;   set LOMEM, find HIMEM
001000r 1               ;   fall into NEW
001000r 1               ;
001000r 1  A0 00        COLD:           ldy     #$00
001002r 1  84 A0                        sty     NOUNSTKC
001004r 1  84 4A                        sty     LOMEM             ;LOMEM = $0800
001006r 1  84 4C                        sty     HIMEM             ;HIMEM = $0800
001008r 1  A9 08                        lda     #$08
00100Ar 1  85 4B                        sta     LOMEM+1
00100Cr 1  85 4D                        sta     HIMEM+1
00100Er 1  E6 4D        Loop50:          inc     HIMEM+1           ;find top of RAM
001010r 1  B1 4C                        lda     (HIMEM),y
001012r 1  49 FF                        eor     #$ff
001014r 1  91 4C                        sta     (HIMEM),y
001016r 1  D1 4C                        cmp     (HIMEM),y
001018r 1  D0 08                        bne     LF022
00101Ar 1  49 FF                        eor     #$ff
00101Cr 1  91 4C                        sta     (HIMEM),y
00101Er 1  D1 4C                        cmp     (HIMEM),y
001020r 1  F0 EC                        beq     Loop50             ;(always, unless RAM is broken)
001022r 1               
001022r 1  4C rr rr     LF022:          jmp     NEW
001025r 1               
001025r 1  4C rr rr     LF025:          jmp     LF179
001028r 1               
001028r 1  20 rr rr     unref_f028:     jsr     from_unref
00102Br 1  4C rr rr                     jmp     LE8BE
00102Er 1               
00102Er 1  A6 E0        LF02E:           ldx     PX
001030r 1  A5 E1                        lda     PX+1
001032r 1  AC rr rr     from_unref:     ldy     KBD               ;get keypress
001035r 1  C0 83                        cpy     #ETX+128          ;is it Ctrl+C?
001037r 1  D0 EC                        bne     LF025             ;no
001039r 1  2C 10 C0                     bit     KBDSTRB           ;yes, clear keypress
00103Cr 1  86 50                        stx     NOUNSTKL
00103Er 1  85 51                        sta     NOUNSTKL+1
001040r 1  A5 DC                        lda     PR                ;NOUNSTKH = PR
001042r 1  85 78                        sta     NOUNSTKH
001044r 1  A5 DD                        lda     PR+1
001046r 1  85 79                        sta     NOUNSTKH+1
001048r 1  4C rr rr                     jmp     STOPPED_AT
00104Br 1               
00104Br 1  FF FF                        .byte   $ff,$ff
00104Dr 1               
00104Dr 1               ;
00104Dr 1               ; Token $10 HIMEM:
00104Dr 1               ;
00104Dr 1  20 rr rr     VHIMEM:         jsr     GET16BIT
001050r 1  86 D8                        stx     XSAVE
001052r 1  A2 FE                        ldx     #$fe
001054r 1  38                           sec
001055r 1  B5 D0        Loop51:          lda     ACC+2,x           ;P2 = ACC
001057r 1  95 E6                        sta     P2+2,x
001059r 1  B5 4E                        lda     HIMEM+2,x         ;AUX = HIMEM - ACC
00105Br 1  F5 D0                        sbc     ACC+2,x
00105Dr 1  95 DC                        sta     AUX+2,x
00105Fr 1  E8                           inx
001060r 1  D0 F3                        bne     Loop51          ; ?
001062r 1  90 4B                        bcc     LF0AF
001064r 1               ;
001064r 1  CA                           dex                       ;X-reg = $ff
001065r 1  B5 CB        Loop52:          lda     PP+1,x            ;P3 = PP
001067r 1  95 E7                        sta     P3+1,x
001069r 1  F5 DB                        sbc     AUX+1,x           ;P2 = PP - AUX
00106Br 1  95 E5                        sta     P2+1,x
00106Dr 1  E8                           inx
00106Er 1  F0 F5                        beq     Loop52           ; ? ;compare PV to P2
001070r 1  90 0A                        bcc     JmpMEMFULL
001072r 1  A5 CC                        lda     PV
001074r 1  C5 E4                        cmp     P2
001076r 1  A5 CD                        lda     PV+1
001078r 1  E5 E5                        sbc     P2+1
00107Ar 1  90 13                        bcc     NoInc3
00107Cr 1  4C rr rr     JmpMEMFULL:     jmp     MEMFULL
00107Fr 1               
00107Fr 1  B1 E6        Loop53:           lda     (P3),y
001081r 1  91 E4                        sta     (P2),y
001083r 1  E6 E4                        inc     P2
001085r 1  D0 02                        bne     NoInc2
001087r 1  E6 E5                        inc     P2+1
001089r 1  E6 E6        NoInc2:         inc     P3
00108Br 1  D0 02                        bne     NoInc3
00108Dr 1  E6 E7                        inc     P3+1
00108Fr 1  A5 E6        NoInc3:        lda     P3                ;compare P3 and HIMEM
001091r 1  C5 4C                        cmp     HIMEM
001093r 1  A5 E7                        lda     P3+1
001095r 1  E5 4D                        sbc     HIMEM+1
001097r 1  90 E6                        bcc     Loop53
001099r 1               ;
001099r 1  A2 FE        LF099:          ldx     #$fe
00109Br 1  B5 E6        Loop54:         lda     P2+2,x            ;P2 = HIMEM
00109Dr 1  95 4E                        sta     HIMEM+2,x
00109Fr 1  B5 CC                        lda     PP+2,x            ;PP = PP - AUX
0010A1r 1  F5 DC                        sbc     AUX+2,x
0010A3r 1  95 CC                        sta     PP+2,x
0010A5r 1  E8                           inx
0010A6r 1  D0 F3                        bne     Loop54
0010A8r 1  A6 D8                        ldx     XSAVE
0010AAr 1  60                           rts
0010ABr 1               
0010ABr 1  B1 4C        LF0AB:           lda     (HIMEM),y
0010ADr 1  91 CE                        sta     (ACC),y
0010AFr 1  A5 CE        LF0AF:           lda     ACC
0010B1r 1  D0 02                        bne     NoInc8
0010B3r 1  C6 CF                        dec     ACC+1
0010B5r 1  C6 CE        NoInc8:         dec     ACC
0010B7r 1  A5 4C                        lda     HIMEM
0010B9r 1  D0 02                        bne     NoInc9
0010BBr 1  C6 4D                        dec     HIMEM+1
0010BDr 1  C6 4C        NoInc9:         dec     HIMEM
0010BFr 1  C5 CA                        cmp     PP                ;compare PP to HIMEM
0010C1r 1  A5 4D                        lda     HIMEM+1
0010C3r 1  E5 CB                        sbc     PP+1
0010C5r 1  90 E4                        bcc     LF0AB
0010C7r 1  B0 D0                        bcs     LF099             ;(always)
0010C9r 1               
0010C9r 1               ;
0010C9r 1               ; Token $11 LOMEM:
0010C9r 1               ;
0010C9r 1  20 rr rr     VLOMEM:         jsr     GET16BIT
0010CCr 1  A4 CE                        ldy     ACC
0010CEr 1  C4 CA                        cpy     PP
0010D0r 1               ; BUG: above line should be CPY PP, was cpy #PP
0010D0r 1  A5 CF                        lda     ACC+1
0010D2r 1  E5 CB                        sbc     PP+1
0010D4r 1  B0 A6        BcsJmpMEMFULL:  bcs     JmpMEMFULL
0010D6r 1  84 4A                        sty     LOMEM
0010D8r 1  A5 CF                        lda     ACC+1
0010DAr 1  85 4B                        sta     LOMEM+1
0010DCr 1  4C rr rr                     jmp     CLR
0010DFr 1               
0010DFr 1               ;
0010DFr 1               ; Token $04 LOAD
0010DFr 1               ;
0010DFr 1  86 D8        LOAD:           stx     XSAVE
0010E1r 1  20 rr rr                     jsr     SETHDR
0010E4r 1  20 rr rr                     jsr     MON_READ
0010E7r 1  A2 FF                        ldx     #$ff
0010E9r 1  38                           sec
0010EAr 1  B5 4D        Loop55:         lda     HIMEM+1,x         ;AUX = HIMEM - ACC
0010ECr 1  F5 CF                        sbc     ACC+1,x
0010EEr 1  95 DB                        sta     AUX+1,x
0010F0r 1  E8                           inx
0010F1r 1  F0 F7                        beq     Loop55
0010F3r 1  90 87                        bcc     JmpMEMFULL
0010F5r 1  A5 CC                        lda     PV                ;compare PV to AUX
0010F7r 1  C5 DA                        cmp     AUX
0010F9r 1  A5 CD                        lda     PV+1
0010FBr 1  E5 DB                        sbc     AUX+1
0010FDr 1  B0 D5                        bcs     BcsJmpMEMFULL
0010FFr 1  A5 CE                        lda     ACC               ;is ACC zero?
001101r 1  D0 04                        bne     LF107
001103r 1  A5 CF                        lda     ACC+1
001105r 1  F0 11                        beq     LF118             ;yes
001107r 1  A5 DA        LF107:          lda     AUX               ;PP = AUX
001109r 1  85 CA                        sta     PP
00110Br 1  A5 DB                        lda     AUX+1
00110Dr 1  85 CB                        sta     PP+1
00110Fr 1  20 rr rr                     jsr     SETPRG
001112r 1  20 rr rr                     jsr     MON_READ
001115r 1  A6 D8        LF115:          ldx     XSAVE
001117r 1  60                           rts
001118r 1               
001118r 1  20 rr rr     LF118:          jsr     MON_BELL
00111Br 1  4C rr rr                     jmp     LF115
00111Er 1               
00111Er 1  A0 CE        SETHDR:         ldy     #$ce
001120r 1  84 3C                        sty     MON_A1L           ;A1 = $00ce
001122r 1  C8                           iny
001123r 1  84 3E                        sty     MON_A2L           ;A2 = $00cd
001125r 1  A0 00                        ldy     #$00
001127r 1  84 3D                        sty     MON_A1H
001129r 1  84 3F                        sty     MON_A2H
00112Br 1  60                           rts
00112Cr 1               
00112Cr 1  B5 CA        SETPRG:         lda     PP,x
00112Er 1  95 3C                        sta     MON_A1L,x
001130r 1  B4 4C                        ldy     HIMEM,x
001132r 1  94 3E                        sty     MON_A2L,x
001134r 1  CA                           dex
001135r 1  10 F5                        bpl     SETPRG
001137r 1  A5 3E                        lda     MON_A2L           ;decrement A2
001139r 1  D0 02                        bne     LF13D
00113Br 1  C6 3F                        dec     MON_A2H
00113Dr 1  C6 3E        LF13D:          dec     MON_A2L
00113Fr 1  60                           rts
001140r 1               
001140r 1  86 D8        unref_f140:     stx     XSAVE
001142r 1               ;
001142r 1               ; Token $05 SAVE
001142r 1               ;
001142r 1  38           SAVE:            sec                       ;ACC = HIMEM - PP
001143r 1  A2 FF                        ldx     #$ff
001145r 1  B5 4D        Loop56:           lda     HIMEM+1,x
001147r 1  F5 CB                        sbc     PP+1,x
001149r 1  95 CF                        sta     ACC+1,x
00114Br 1  E8                           inx
00114Cr 1  F0 F7                        beq     Loop56
00114Er 1               ;
00114Er 1  20 rr rr                     jsr     SETHDR
001151r 1  20 rr rr                     jsr     MON_WRITE
001154r 1  A2 01                        ldx     #$01
001156r 1  20 rr rr                     jsr     SETPRG
001159r 1  A9 1A                        lda     #$1a
00115Br 1  20 rr rr                     jsr     MON_WRITE0
00115Er 1  A6 D8                        ldx     XSAVE
001160r 1  60                           rts
001161r 1               
001161r 1  20 rr rr     PRTERR:         jsr     ERRORMESS
001164r 1  4C rr rr                     jmp     MON_BELL
001167r 1               
001167r 1               ;
001167r 1               ; Token $77 POP
001167r 1               ;
001167r 1  A5 FC        POP:            lda     GOSUBNDX
001169r 1  D0 03                        bne     LF16E
00116Br 1  4C rr rr                     jmp     RETURN
00116Er 1               
00116Er 1  C6 FC        LF16E:          dec     GOSUBNDX
001170r 1  60                           rts
001171r 1               
001171r 1               ;
001171r 1               ; Token $7d TRACE
001171r 1               ;
001171r 1  A9 FF        TRACE:          lda     #$ff
001173r 1  85 A0                        sta     NOUNSTKC
001175r 1  60                           rts
001176r 1               
001176r 1               ;
001176r 1               ; Token $7a NOTRACE
001176r 1               ;
001176r 1  46 A0        NOTRACE:        lsr     NOUNSTKC          ;clear bit 7
001178r 1  60                           rts
001179r 1               
001179r 1  24 A0        LF179:          bit     NOUNSTKC          ;trace mode?
00117Br 1  10 19                        bpl     Rtn20          ;no
00117Dr 1  A9 23        LF17D:          lda     #'#'              ;yes, print line number
00117Fr 1  20 rr rr                     jsr     MON_COUT
001182r 1  A0 01                        ldy     #$01
001184r 1  B1 DC                        lda     (PR),y
001186r 1  AA                           tax
001187r 1  C8                           iny
001188r 1  B1 DC                        lda     (PR),y
00118Ar 1  20 rr rr                     jsr     PRDEC
00118Dr 1  A9 A0                        lda     #BLANK+128
00118Fr 1  4C rr rr                     jmp     MON_COUT
001192r 1               
001192r 1  A5 DC        unref_f192:     lda     PR
001194r 1  A4 DD                        ldy     PR+1
001196r 1  60           Rtn20:          rts
001197r 1               
001197r 1               ;
001197r 1               ; Indices into SYNTABL.
001197r 1               ;
001197r 1  C1 00 7F D1  SYNTABLNDX:     .byte   $c1,$00,$7f,$d1,$cc,$c7,$cf,$ce
00119Br 1  CC C7 CF CE  
00119Fr 1  C5 9A 98 8D                  .byte   $c5,$9a,$98,$8d,$96,$95,$93,$bf
0011A3r 1  96 95 93 BF  
0011A7r 1  B2 32 12 0F                  .byte   $b2,$32,$12,$0f,$bc,$b0,$ac,$be
0011ABr 1  BC B0 AC BE  
0011AFr 1  35 0C 61 30                  .byte   $35,$0c,$61,$30,$10,$0b,$dd,$fb
0011B3r 1  10 0B DD FB  
0011B7r 1               
0011B7r 1  A0 00        LF1B7:          ldy     #$00
0011B9r 1  20 rr rr                     jsr     LE7C7
0011BCr 1  A9 A0                        lda     #$a0
0011BEr 1  4C rr rr                     jmp     MON_COUT
0011C1r 1               
0011C1r 1  00 00 00 00                  .byte   $00,$00,$00,$00,$00,$00,$00,$00
0011C5r 1  00 00 00 00  
0011C9r 1               
0011C9r 1  A4 4A        LF1C9:          ldy     LOMEM
0011CBr 1  A5 4B                        lda     LOMEM+1
0011CDr 1  48           Loop60:          pha
0011CEr 1  C4 DA                        cpy     AUX               ;compare LOMEM to AUX
0011D0r 1  E5 DB                        sbc     AUX+1
0011D2r 1  B0 1C                        bcs     LF1F0
0011D4r 1  68                           pla
0011D5r 1  84 D0                        sty     SRCH              ;SRCH = LOMEM
0011D7r 1  85 D1                        sta     TOKNDXSTK
0011D9r 1  A0 FF                        ldy     #$ff
0011DBr 1  C8           Loop61:         iny
0011DCr 1  B1 D0                        lda     (SRCH),y
0011DEr 1  30 FB                        bmi     Loop61
0011E0r 1  C9 40                        cmp     #$40
0011E2r 1  F0 F7                        beq     Loop61
0011E4r 1  C8                           iny
0011E5r 1  C8                           iny
0011E6r 1  B1 D0                        lda     (SRCH),y
0011E8r 1  48                           pha
0011E9r 1  88                           dey
0011EAr 1  B1 D0                        lda     (SRCH),y
0011ECr 1  A8                           tay
0011EDr 1  68                           pla
0011EEr 1  D0 DD                        bne     Loop60
0011F0r 1               ;
0011F0r 1  68           LF1F0:          pla
0011F1r 1  A0 00                        ldy     #$00
0011F3r 1  B1 D0        LF1F3:          lda     (SRCH),y
0011F5r 1  30 05                        bmi     LF1FC
0011F7r 1  4A                           lsr     A
0011F8r 1  F0 08                        beq     LF202
0011FAr 1  A9 24                        lda     #'$'
0011FCr 1  20 rr rr     LF1FC:          jsr     MON_COUT
0011FFr 1  C8                           iny
001200r 1  D0 F1                        bne     LF1F3
001202r 1  A9 3D        LF202:          lda     #'='
001204r 1  4C rr rr                     jmp     MON_COUT
001207r 1               
001207r 1  91 DA        LF207:          sta     (AUX),y
001209r 1  E8                           inx
00120Ar 1  B5 9F                        lda     NOUNSTKC-1,x
00120Cr 1  F0 30                        beq     Rtn22
00120Er 1  4C rr rr                     jmp     LF3D5
001211r 1               
001211r 1  A0                           .byte    $a0
001212r 1               
001212r 1  30 07        LF212:          bmi     LF21B
001214r 1  A5 DC                        lda     PR
001216r 1  A4 DD                        ldy     PR+1
001218r 1  20 rr rr                     jsr     LF17D
00121Br 1  20 rr rr     LF21B:          jsr     LF1C9
00121Er 1  A6 D8                        ldx     XSAVE
001220r 1  4C rr rr                     jmp     LF1B7
001223r 1               
001223r 1  E8           LF223:           inx
001224r 1  E8                           inx
001225r 1  B5 9F                        lda     NOUNSTKC-1,x
001227r 1  F0 1F                        beq     Rtn23    ; may be Rtn22?  offset is 31 bytes in disassem, not 22
001229r 1  4C rr rr                     jmp     LF3E0
00122Cr 1               
00122Cr 1  30 07        LF22C:          bmi     LF235
00122Er 1  A5 DC                        lda     PR
001230r 1  A4 DD                        ldy     PR+1
001232r 1  20 rr rr                     jsr     LF17D
001235r 1  20 rr rr     LF235:          jsr     LF1C9
001238r 1  A6 D8                        ldx     XSAVE
00123Ar 1  4C rr rr                     jmp     LF409
00123Dr 1               
00123Dr 1  E8                           .byte    $e8
00123Er 1               
00123Er 1  60           Rtn22:          rts
00123Fr 1               
00123Fr 1  20 rr rr     LF23F:          jsr     GET16BIT
001242r 1  E6 CE                        inc     ACC
001244r 1  D0 02                        bne     Rtn23
001246r 1  E6 CF                        inc     ACC+1
001248r 1  60           Rtn23:          rts
001249r 1               
001249r 1               ;
001249r 1               ; Token $1c <
001249r 1               ;   IF X < 13 THEN END
001249r 1               ;
001249r 1  20 rr rr     TF249:          jsr     TF25B
00124Cr 1  D0 15                        bne     JmpNOT
00124Er 1               ;
00124Er 1               ; Token $19 >
00124Er 1               ;   IF X > 13 THEN END
00124Er 1               ;
00124Er 1  20 rr rr     TF24E:          jsr     TF253
001251r 1  D0 10                        bne     JmpNOT
001253r 1               ;
001253r 1               ; Token $1a <=
001253r 1               ;   IF X <= 13 THEN END
001253r 1               ;
001253r 1  20 rr rr     TF253:          jsr     SUBTRACT
001256r 1  20 rr rr                     jsr     NEGATE
001259r 1  50 03                        bvc     LF25E
00125Br 1               ;
00125Br 1               ; Token $18 >=
00125Br 1               ;   IF X >= 13 THEN END
00125Br 1               ;
00125Br 1  20 rr rr     TF25B:          jsr     SUBTRACT
00125Er 1  20 rr rr     LF25E:          jsr     SGN
001261r 1  56 50                        lsr     NOUNSTKL,x
001263r 1  4C rr rr     JmpNOT:         jmp     NOT
001266r 1               
001266r 1               ;
001266r 1               ; Token $1d AND
001266r 1               ;
001266r 1  20 rr rr     VAND:           jsr     LEFC9
001269r 1  15 4F                        ora     NOUNSTKL-1,x
00126Br 1  10 05                        bpl     LF272             ;(always?)
00126Dr 1               ;
00126Dr 1               ; Token $1e OR
00126Dr 1               ;
00126Dr 1  20 rr rr     VOR:            jsr     LEFC9
001270r 1  35 4F                        and     NOUNSTKL-1,x
001272r 1  95 50        LF272:           sta     NOUNSTKL,x
001274r 1  10 ED                        bpl     JmpNOT
001276r 1  4C rr rr                     jmp     LEFC9
001279r 1               
001279r 1               ;
001279r 1               ; Token $58 STEP
001279r 1               ;
001279r 1  20 rr rr     STEP:           jsr     GET16BIT
00127Cr 1  A4 FB                        ldy     FORNDX
00127Er 1  A5 CE                        lda     ACC
001280r 1  99 5F 01                     sta     STK_60-1,y
001283r 1  A5 CF                        lda     ACC+1
001285r 1  4C rr rr                     jmp     LE966
001288r 1               
001288r 1  99 50 01     LF288:          sta     STK_50,y
00128Br 1  88           Loop66:         dey
00128Cr 1  30 51                        bmi     Rtn40
00128Er 1  B9 40 01                     lda     STK_40,y
001291r 1  D5 50                        cmp     NOUNSTKL,x
001293r 1  D0 F6                        bne     Loop66
001295r 1  B9 50 01                     lda     STK_50,y
001298r 1  D5 78                        cmp     NOUNSTKH,x
00129Ar 1  D0 EF                        bne     Loop66
00129Cr 1  C6 FB                        dec     FORNDX
00129Er 1  B9 41 01     Loop67:         lda     STK_40+1,y
0012A1r 1  99 40 01                     sta     STK_40,y
0012A4r 1  B9 51 01                     lda     STK_50+1,y
0012A7r 1  99 50 01                     sta     STK_50,y
0012AAr 1  B9 C1 01                     lda     STK_C0+1,y
0012ADr 1  99 C0 01                     sta     STK_C0,y
0012B0r 1  B9 D1 01                     lda     STK_D0+1,y
0012B3r 1  99 D0 01                     sta     STK_D0,y
0012B6r 1  B9 61 01                     lda     STK_60+1,y
0012B9r 1  99 60 01                     sta     STK_60,y
0012BCr 1  B9 71 01                     lda     STK_70+1,y
0012BFr 1  99 70 01                     sta     STK_70,y
0012C2r 1  B9 81 01                     lda     STK_80+1,y
0012C5r 1  99 80 01                     sta     STK_80,y
0012C8r 1  B9 91 01                     lda     STK_90+1,y
0012CBr 1  99 90 01                     sta     STK_90,y
0012CEr 1  B9 A1 01                     lda     STK_A0+1,y
0012D1r 1  99 A0 01                     sta     STK_A0,y
0012D4r 1  B9 B1 01                     lda     STK_B0+1,y
0012D7r 1  99 B0 01                     sta     STK_B0,y
0012DAr 1               ; BUG: above two lines should be:  FIXED
0012DAr 1               ;   LDA STK_B0+1,Y   was lda     STK_A0+1,y
0012DAr 1               ;   STA STK_B0,Y     was sta     STK_A0,y
0012DAr 1  C8                           iny
0012DBr 1  C4 FB                        cpy     FORNDX
0012DDr 1  90 BF                        bcc     Loop67
0012DFr 1  60           Rtn40:          rts
0012E0r 1               
0012E0r 1               ;
0012E0r 1               ; Token $78 NODSP
0012E0r 1               ;   string var
0012E0r 1               ;
0012E0r 1  E8           NODSP_STR:       inx
0012E1r 1               ;
0012E1r 1               ; Token $79 NODSP
0012E1r 1               ;   num var
0012E1r 1               ;
0012E1r 1  A9 00        NODSP_NUM:      lda     #$00
0012E3r 1  48           LF2E3:          pha
0012E4r 1  B5 50                        lda     NOUNSTKL,x
0012E6r 1  38                           sec
0012E7r 1  E9 03                        sbc     #$03
0012E9r 1  85 CE                        sta     ACC
0012EBr 1  B5 78                        lda     NOUNSTKH,x
0012EDr 1  E9 00                        sbc     #$00
0012EFr 1  85 CF                        sta     ACC+1
0012F1r 1  68                           pla
0012F2r 1  A0 00                        ldy     #$00
0012F4r 1  91 CE                        sta     (ACC),y
0012F6r 1  E8                           inx
0012F7r 1  60                           rts
0012F8r 1               
0012F8r 1  C9 85        LF2F8:          cmp     #$85
0012FAr 1  B0 03                        bcs     LF2FF
0012FCr 1  4C rr rr                     jmp     LE4C0
0012FFr 1               
0012FFr 1  A0 02        LF2FF:          ldy     #$02
001301r 1  4C rr rr                     jmp     LE448
001304r 1               
001304r 1               ;
001304r 1               ; Token $7b DSP
001304r 1               ;   string var
001304r 1               ;
001304r 1  E8           DSP_STR:        inx                       ;[DSP_NUM in paulrsm disasm]
001305r 1               ;
001305r 1               ; Token $7c DSP
001305r 1               ;   num var
001305r 1               ;
001305r 1  A9 01        DSP_NUM:        lda     #$01              ;[DSP_STR in paulrsm disasm]
001307r 1  D0 DA                        bne     LF2E3             ;(always)
001309r 1               
001309r 1  E8                           .byte    $e8
00130Ar 1               
00130Ar 1               ;
00130Ar 1               ; Token $06 CON
00130Ar 1               ;
00130Ar 1  A5 78        CON:            lda     NOUNSTKH          ;PR = NOUNSTKH
00130Cr 1  85 DC                        sta     PR
00130Er 1  A5 79                        lda     NOUNSTKH+1
001310r 1  85 DD                        sta     PR+1
001312r 1  A5 50                        lda     NOUNSTKL
001314r 1  A4 51                        ldy     NOUNSTKL+1
001316r 1  4C rr rr                     jmp     GETNEXT
001319r 1               
001319r 1  A9 01        unref_f319:     lda     #$01
00131Br 1  D0 C6                        bne     LF2E3
00131Dr 1               
00131Dr 1               ;
00131Dr 1               ; Token $3c ASC(
00131Dr 1               ;
00131Dr 1  B5 50        ASC:            lda     NOUNSTKL,x
00131Fr 1  D5 78                        cmp     NOUNSTKH,x
001321r 1  90 03                        bcc     LF326
001323r 1  4C rr rr                     jmp     RANGERR
001326r 1               
001326r 1  A8           LF326:          tay
001327r 1  B5 51                        lda     NOUNSTKL+1,x
001329r 1  85 CE                        sta     ACC
00132Br 1  B5 79                        lda     NOUNSTKH+1,x
00132Dr 1  85 CF                        sta     ACC+1
00132Fr 1  B1 CE                        lda     (ACC),y
001331r 1  A0 00                        ldy     #$00
001333r 1  E8                           inx
001334r 1  E8                           inx
001335r 1  20 rr rr                     jsr     LE708
001338r 1  4C rr rr                     jmp     LF404
00133Br 1               
00133Br 1               ;
00133Br 1               ; Token $32 PDL
00133Br 1               ;
00133Br 1  20 rr rr     PDL:            jsr     GETBYTE
00133Er 1  86 D8                        stx     XSAVE
001340r 1  29 03                        and     #$03
001342r 1  AA                           tax
001343r 1  20 rr rr                     jsr     MON_PREAD
001346r 1  A6 D8                        ldx     XSAVE
001348r 1  98                           tya
001349r 1  A0 00                        ldy     #$00
00134Br 1  20 rr rr                     jsr     LE708
00134Er 1  94 A0                        sty     NOUNSTKC,x
001350r 1  60                           rts
001351r 1               
001351r 1  20 75 FD     RDKEY:          jsr     MON_NXTCHAR
001354r 1  8A           LF354:          txa
001355r 1  48                           pha
001356r 1  BD 00 02     Loop68:         lda     IN,x
001359r 1  C9 83                        cmp     #ETX+128          ;is it Ctrl+C?
00135Br 1  D0 03                        bne     LF360
00135Dr 1  4C rr rr                     jmp     BASIC2
001360r 1               
001360r 1  CA           LF360:          dex
001361r 1  10 F3                        bpl     Loop68
001363r 1  68                           pla
001364r 1  AA                           tax
001365r 1  60                           rts
001366r 1               
001366r 1  20 rr rr     LF366:          jsr     LE280
001369r 1  98                           tya
00136Ar 1  AA                           tax
00136Br 1  20 rr rr                     jsr     LF354
00136Er 1  8A                           txa
00136Fr 1  A8                           tay
001370r 1  60                           rts
001371r 1               
001371r 1               ;
001371r 1               ; Token $20 ^
001371r 1               ;
001371r 1  20 rr rr     EXP:            jsr     GET16BIT
001374r 1  A5 CF                        lda     ACC+1
001376r 1  10 08                        bpl     LF380
001378r 1  98                           tya                       ;A-reg = 0
001379r 1  CA                           dex
00137Ar 1  20 rr rr                     jsr     LE708
00137Dr 1  94 A0                        sty     NOUNSTKC,x
00137Fr 1  60           Rtn25:          rts
001380r 1               
001380r 1  85 D1        LF380:          sta     SRCH+1            ;SRCH = ACC
001382r 1  A5 CE                        lda     ACC
001384r 1  85 D0                        sta     SRCH
001386r 1  20 rr rr                     jsr     GET16BIT
001389r 1  A5 CE                        lda     ACC               ;SRCH2 = ACC
00138Br 1  85 D2                        sta     SRCH2
00138Dr 1  A5 CF                        lda     ACC+1
00138Fr 1  85 D3                        sta     SRCH2+1
001391r 1  A9 01                        lda     #$01
001393r 1  20 rr rr                     jsr     LE708
001396r 1  94 A0                        sty     NOUNSTKC,x
001398r 1               ;
001398r 1  A5 D0        Loop69:         lda     SRCH              ;srch = SRCH - 1
00139Ar 1  D0 04                        bne     NoDec
00139Cr 1  C6 D1                        dec     SRCH+1            ;is SRCH negative?
00139Er 1  30 DF                        bmi     Rtn25             ;yes, return      which?
0013A0r 1  C6 D0        NoDec:          dec     SRCH
0013A2r 1  A5 D2                        lda     SRCH2
0013A4r 1  A0 00                        ldy     #$00
0013A6r 1  20 rr rr                     jsr     LE708
0013A9r 1  A5 D3                        lda     SRCH2+1
0013ABr 1  95 A0                        sta     NOUNSTKC,x
0013ADr 1  20 rr rr                     jsr     MULT
0013B0r 1  4C rr rr                     jmp     Loop69
0013B3r 1               
0013B3r 1  20 rr rr     LF3B3:           jsr     GETBYTE
0013B6r 1  18                           clc                       ;A-reg = A-reg - 1
0013B7r 1  69 FF                        adc     #$ff
0013B9r 1  60           Rtn26:          rts
0013BAr 1               
0013BAr 1               ;
0013BAr 1               ; Token $4a ,
0013BAr 1               ;   end of PRINT statement
0013BAr 1               ;   PRINT A$,
0013BAr 1               ;
0013BAr 1  20 rr rr     TF3BA:          jsr     LE7B1
0013BDr 1  46 D5                        lsr     CRFLAG            ;pos
0013BFr 1  60                           rts
0013C0r 1               
0013C0r 1  86 D9        unref_f3c0:     stx     RUNFLAG
0013C2r 1  9A                           txs
0013C3r 1  20 rr rr                     jsr     LF02E
0013C6r 1  4C rr rr                     jmp     LE883
0013C9r 1               
0013C9r 1               ;
0013C9r 1               ; Token $7e PR#
0013C9r 1               ;
0013C9r 1  20 rr rr     PRSLOT:         jsr     GETBYTE
0013CCr 1  86 D8                        stx     XSAVE
0013CEr 1  20 rr rr                     jsr     MON_OUTPORT
0013D1r 1  A6 D8                        ldx     XSAVE
0013D3r 1  60                           rts
0013D4r 1               
0013D4r 1  FE                           .byte    $fe
0013D5r 1               
0013D5r 1  24 D9        LF3D5:          bit     RUNFLAG
0013D7r 1  10 E0                        bpl     Rtn26          ; ??
0013D9r 1  86 D8                        stx     XSAVE
0013DBr 1  24 A0                        bit     NOUNSTKC
0013DDr 1  4C rr rr                     jmp     LF212
0013E0r 1               
0013E0r 1  24 D9        LF3E0:          bit     RUNFLAG
0013E2r 1  10 D5                        bpl     Rtn26          ; ??
0013E4r 1  86 D8                        stx     XSAVE
0013E6r 1  24 A0                        bit     NOUNSTKC
0013E8r 1  4C rr rr                     jmp     LF22C
0013EBr 1               
0013EBr 1  A0 00        LF3EB:          ldy     #$00
0013EDr 1  4C rr rr                     jmp     GETVERB
0013F0r 1               
0013F0r 1  A8           Loop70:         tay
0013F1r 1  20 rr rr                     jsr     MON_CROUT
0013F4r 1  98           LF3F4:           tya
0013F5r 1  38                           sec
0013F6r 1  E5 21                        sbc     MON_WNDWDTH
0013F8r 1  B0 F6                        bcs     Loop70             ; ??
0013FAr 1  84 24                        sty     MON_CH
0013FCr 1  60                           rts
0013FDr 1               
0013FDr 1  00 00 00 FF                  .byte   $00,$00,$00,$ff,$ff,$ff,$ff
001401r 1  FF FF FF     
001404r 1               
001404r 1  94 A0        LF404:          sty     NOUNSTKC,x
001406r 1  4C rr rr                     jmp     TE823
001409r 1               
001409r 1  A0 00        LF409:          ldy     #$00
00140Br 1  F0 04                        beq     LF411             ;(always)
00140Dr 1               
00140Dr 1  20 rr rr     Loop71:         jsr     MON_COUT
001410r 1  C8                           iny
001411r 1  B1 DA        LF411:          lda     (AUX),y
001413r 1  30 F8                        bmi     Loop71
001415r 1  A9 FF                        lda     #$ff
001417r 1  85 D5                        sta     CRFLAG            ;CRFLAG = $ff
001419r 1  60                           rts
00141Ar 1               
00141Ar 1               ;
00141Ar 1               ; Token $7f IN#
00141Ar 1               ;
00141Ar 1  20 rr rr     INSLOT:         jsr     GETBYTE
00141Dr 1  86 D8                        stx     XSAVE
00141Fr 1  20 rr rr                     jsr     MON_INPORT
001422r 1  A6 D8                        ldx     XSAVE
001424r 1  60                           rts
001425r 1               ;
001425r 1               ;  BIOS interface stuff
001425r 1               ;
001425r 1               .segment "BIOS"
000000r 1               MON_CROUT:
000000r 1  A9 0D 20 B6                   WRITECRLF
000004r 1  F8 A9 0A 20  
000008r 1  B6 F8        
00000Ar 1  60                            rts
00000Br 1               ;
00000Br 1               KBD:
00000Br 1  20 43 F8                      jsr READ_CHAR
00000Er 1  49 80                         eor #$80
000010r 1  60                            rts
000011r 1               ;
000011r 1               MON_COUT:
000011r 1  49 80                         eor #$80
000013r 1  20 B6 F8                      jsr WRITE_CHAR
000016r 1  60                            rts
000017r 1               ;
000017r 1               ;
000017r 1               ;   Apple Graphics BIOS calls
000017r 1               ;
000017r 1               MON_PLOT:       ;    .eq     $f800             ;lo-res plot at X=Y-reg, Y=Acc
000017r 1               MON_HLINE:      ;    .eq     $f819             ;lo-res horiz line at Y=Acc with X from $2c
000017r 1               MON_VLINE:      ;    .eq     $f828             ;lo-res vert line at X=Y-reg and Y from Acc to $2b
000017r 1               MON_GBASCALC:   ;    .eq     $f847             ;compute gfx base addr for line in Acc
000017r 1               MON_SETCOL:     ;    .eq     $f864             ;set lo-res color to Acc
000017r 1               MON_PREAD:      ;    .eq     $fb1e             ;read paddle specifed by X-reg, return in Y-reg
000017r 1               MON_SETTXT:     ;    .eq     $fb39             ;set screen to text mode
000017r 1               MON_SETGR:      ;    .eq     $fb40             ;set screen to graphics mode
000017r 1               MON_VTAB:       ;    .eq     $fc22             ;tab to row specified in Acc
000017r 1  60                         rts
000018r 1               ;
000018r 1               ;   other Apple BIOS calls
000018r 1               ;
000018r 1               MON_INPORT:
000018r 1               MON_OUTPORT:
000018r 1               MON_WRITE:
000018r 1               MON_WRITE0:
000018r 1               MON_READ:
000018r 1               MON_BELL:
000018r 1  60                          rts
000019r 1               ;
000019r 1               ;  end of intbasic.s
000019r 1               ;
000019r 1               
